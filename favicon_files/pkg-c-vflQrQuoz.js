define("modules/clean/flux/flux_store",function(){var e;return e=function(){function e(e){this._listeners=[],this._dispatcher=e,this._dispatchToken=this._dispatcher.register(this.__onDispatch.bind(this))}return e.prototype.teardown=function(){return this._dispatcher.unregister(this._dispatchToken)},e.prototype.getDispatcher=function(){return this._dispatcher},e.prototype.getDispatchToken=function(){return this._dispatchToken},e.prototype.addListener=function(e){return this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return this._listeners=function(){var n,i,a,r;for(a=this._listeners,r=[],n=0,i=a.length;i>n;n++)t=a[n],t!==e&&r.push(t);return r}.call(this)},e.prototype.hasChanged=function(){throw new Error("Not Implemented")},e.prototype.__emitChange=function(){var e,t,n,i,a;for(i=this._listeners,a=[],t=0,n=i.length;n>t;t++)e=i[t],a.push(e());return a},e.prototype.__onDispatch=function(){throw new Error("__onDispatch should be overridden by subclass")},e}()}),define("modules/clean/recent_activity/react/attachment_file_icon_view",["external/underscore","external/react","modules/clean/em_string","modules/clean/react/sprite","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,a){var r,s,o,c;return c=t.DOM,o=t.addons.classSet,s=t.PropTypes,r=t.createClass({displayName:"AttachmentFileIconView",propTypes:{id:s.string,file:s.shape({displayName:s.string.isRequired,icon:s.string.isRequired,browseUrl:s.string}),overlayText:s.string,handleClick:s.func,showCheckmark:s.bool,handleToggleSelect:s.func,isSelected:s.bool},getDefaultProps:function(){return{handleClick:e.noop}},_onClick:function(e){return e.preventDefault(),this.props.handleClick(this.props.id)},_renderFilename:function(){var e,t,i;return i=this.props.file.displayName.split("."),t="."+i.pop(),e=n.em_snippet(i.join("."),10),c.span({ref:"filename",className:"attachment-item__filename"},e,c.wbr(),c.span({className:"nowrap"},t))},_renderIcon:function(){return t.createElement(i,{ref:"icon",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},render:function(){var e,n,i,r,s,l,h;return l=this._renderIcon(),s=this._renderFilename(),this.props.overlayText&&(h=c.span({ref:"overlay",className:"attachment-item__overlay"},this.props.overlayText)),this.props.showCheckmark&&(i=t.createElement(a,{id:this.props.id,ref:"checkmark",handleToggleSelect:this.props.handleToggleSelect,isSelected:this.props.isSelected})),n={ref:"anchor",href:this.props.file.browseUrl,title:this.props.file.displayName,className:"attachment-item__anchor",onClick:this._onClick},e=c.a(n,l,s,h,i),r={"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!this.props.overlayText,"attachment-item--selected":this.props.isSelected},c.div({className:o(r)},e)}})}),define("modules/clean/recent_activity/react/attachment_grid",function(){var e;return e=function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,t);return Object(a)===a?a:i}(e,arguments,function(){})},e.prototype.generate=function(e,t){var n,i,a;for(null==t&&(t=1/0),i=[],n=0;i.length<t&&n<e.length;)a=this._buildRow(e.slice(n)),n+=a.length,i.push(a);return i},e.prototype._buildRow=function(e){var t,n,i,a,r;for(r=[],t=this._gridWidth+this._gutterWidth,n=0,a=e.length;a>n&&(i=e[n],t=t-i.width-this._gutterWidth,t>=0||0===r.length);n++)r.push(i);return r},e}()}),define("modules/clean/recent_activity/react/attachment_image_expanded_view",["external/underscore","external/react","modules/core/i18n","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i){var a,r,s,o,c,l;return o=n._,l=t.DOM,c=t.addons.classSet,s=t.PropTypes,r={VIDEO:"video"},a=t.createClass({displayName:"AttachmentImageExpandedView",propTypes:{id:s.string,image:s.shape({thumbnailUrl:s.string.isRequired,browseUrl:s.string,displayName:s.string,width:s.number,height:s.number}),badgeType:s.oneOf(e.values(r)),handleClick:s.func,handleLoadError:s.func,showCheckmark:s.bool,handleToggleSelect:s.func,handleCornerClick:t.PropTypes.func,isSelected:s.bool},_handleCornerClick:function(e){return e.preventDefault(),this.props.handleCornerClick(this.props.id)},render:function(){var e,n;return e=l.div({className:"attachment-item--expanded__image"},t.createElement(i,this.props)),n=l.a({ref:"overlayCorner",className:"attachment-item--expanded__corner",onClick:this._handleCornerClick},"-"),l.div({className:"attachment-item attachment-item--expanded",style:{width:this.props.image.width,height:this.props.image.height}},e,n)}})}),define("modules/clean/recent_activity/react/attachment_image_stack_view",["external/underscore","external/react","modules/core/i18n","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i){var a,r,s,o,c,l;return o=n._,l=t.DOM,c=t.addons.classSet,s=t.PropTypes,r={VIDEO:"video"},a=t.createClass({displayName:"AttachmentImageStackView",propTypes:{id:s.string,image:s.shape({thumbnailUrl:s.string.isRequired,browseUrl:s.string,displayName:s.string,width:s.number,height:s.number}),badgeType:s.oneOf(e.values(r)),handleClick:s.func,handleLoadError:s.func,handleCornerClick:t.PropTypes.func,stackLength:t.PropTypes.number,isSelected:s.bool},_handleCornerClick:function(e){return e.preventDefault(),this.props.handleCornerClick(this.props.id)},render:function(){var n,a,r,s,o,c,h;return s=this.props.image.width,r=this.props.image.height,h=s-4,c=r-4,a=l.div({ref:"imgFront",className:"attachment-item--stacked__front"},t.createElement(i,e.extend({},this.props,{image:e.extend({},this.props.image,{width:h,height:c})}))),n=l.div({ref:"imgBack",className:"attachment-item--stacked__back"},t.createElement(i,{image:e.extend({},this.props.image,{width:h,height:c})})),o=l.a({ref:"overlayCorner",className:"attachment-item--stacked__corner",onClick:this._handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})),l.div({className:"attachment-item attachment-item--stacked",style:{width:s,height:r}},a,n,o)}})}),define("modules/clean/recent_activity/react/attachment_image_view",["external/underscore","external/react","modules/clean/recent_activity/react/selectable_view"],function(e,t,n){var i,a,r,s,o;return o=t.DOM,s=t.addons.classSet,r=t.PropTypes,a={VIDEO:"video"},i=t.createClass({displayName:"AttachmentImageView",statics:{BadgeType:a},propTypes:{id:r.string,image:r.shape({thumbnailUrl:r.string.isRequired,browseUrl:r.string,displayName:r.string,width:r.number,height:r.number}),badgeType:r.oneOf(e.values(a)),overlayText:r.string,handleClick:r.func,handleLoadError:r.func,showCheckmark:r.bool,handleToggleSelect:r.func,isSelected:r.bool},getDefaultProps:function(){return{handleClick:function(){},handleLoadError:function(){},handleToggleSelect:function(){},showCheckmark:!1,isSelected:!1}},getInitialState:function(){return{isLoading:!0}},shouldComponentUpdate:function(t,n){return!e.isEqual(t,this.props)||!e.isEqual(n,this.state)},_onClick:function(e){return e.preventDefault(),this.props.handleClick(this.props.id)},_onLoad:function(){return this.setState({isLoading:!1})},_onError:function(){return this.props.handleLoadError(this.props.id),this.setState({isLoading:!1})},_handletoggleSelected:function(e){return e.preventDefault(),e.stopPropagation(),this.props.handleToggleSelect(this.props.id,!this.props.isSelected)},render:function(){var e,i,a,r,c,l;return c=o.img({ref:"img",className:"attachment-item__thumbnail",src:this.props.image.thumbnailUrl,onLoad:this._onLoad,onError:this._onError}),this.props.overlayText&&(l=o.span({ref:"overlay",className:"attachment-item__overlay"},this.props.overlayText)),this.props.showCheckmark&&(a=t.createElement(n,{id:this.props.id,ref:"checkmark",handleToggleSelect:this.props.handleToggleSelect,isSelected:this.props.isSelected})),i={href:this.props.image.browseUrl,onClick:this._onClick,title:this.props.image.displayName,className:"attachment-item__anchor",style:{width:this.props.image.width,height:this.props.image.height}},e=o.a(i,c,l),r={"attachment-item":!0,"attachment-item--show-more":!!this.props.overlayText,"attachment-item--is-loading":this.state.isLoading,"attachment-item--selected":this.props.isSelected},r["attachment-item--badge-"+this.props.badgeType]=!!this.props.badgeType,o.div({className:s(r)},e,a)}})}),define("modules/clean/recent_activity/react/attachment_list_layout",["external/underscore","modules/core/browser","modules/core/exception","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_grid","modules/clean/recent_activity/react/attachment_multipage_view","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_file_icon_view"],function(e,t,n,i,a,r,s,o){var c,l,h,u,d,p,m,_,f,g,v,y,w,I,E,b,C,T,S,R,A;return A=n.assert,T=i.ThumbnailSizeMode,b=T.FIT_ONE,y=T.EXACT_NO_BACKGROUND,C=100,w=100,v=200,f=200,E=75,I=375,g=750,p=160,u=160,_=320,m=320,d=32,h=92,l=100,S={STANDALONE_SCALED:"standalone-scaled",STANDALONE_CROPPED:"standalone-cropped",AGGREGATED_SCALED:"aggregated-scaled",AGGREGATED_WIDE_CROPPED:"aggregated-wide-cropped",AGGREGATED_CROPPED:"aggregated-cropped"},R=function(n,a){var r,s,o,c;switch(s=t.is_high_density_display(),a){case S.STANDALONE_SCALED:c=s?_:p,r=s?m:u,o=b;break;case S.STANDALONE_CROPPED:c=s?_:p,r=s?m:u,o=y;break;case S.AGGREGATED_SCALED:c=s?v:C,r=s?f:w,o=b;break;case S.AGGREGATED_CROPPED:c=s?v:C,r=s?f:w,o=y;break;case S.AGGREGATED_WIDE_CROPPED:c=s?g:I,r=s?f:w,o=y;break;default:A(!1,"type: "+a+" must be one of: "+e.values(S))}return i.thumbnailUrlForSize(n,c,r,o)},c=function(){function t(e,t,n){this._gridWidth=e,this._columnWidth=t,this._gutterWidth=n,this._grid=a.create(e,n)}return t.create=function(){return function(e,t,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,t);return Object(a)===a?a:i}(t,arguments,function(){})},t.prototype.generate=function(e,t,n){var i;return i=this._cellMetadata(e,n),this._grid.generate(i,t)},t.prototype._cellMetadata=function(t,n){var i,a,r;return a=1===t.length,r=function(e,t){return e[t]=t,e},i=e.reduce(n,r,{}),e.map(t,function(e){return function(t){var n;return n=i[t.id],n?e._buildFileIconViewMetadata(t):t.multipageThumbnailUrl?e._buildMultipageViewMetadata(t):a?e._buildStandaloneImageViewMetadata(t):e._buildImageViewMetadata(t)}}(this))},t.prototype._buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:o,width:h,height:l,attachment:e}},t.prototype._buildImageViewMetadata=function(e){var t,n,i,a,r;return i=e.thumbnailUrl,n=this._calculateThumbnailDimensions(e.thumbnailDimensions),r=n.width,t=n.height,a=n.variant,0!==i.indexOf("data:")&&(i=R(i,a)),{id:e.id,view:s,scaledThumbnailUrl:i,width:r,height:t,attachment:e}},t.prototype._calculateThumbnailDimensions=function(e){var t,n,i,a;return e&&(a=S.AGGREGATED_SCALED,t=e.width/e.height,n=w,i=Math.floor(t*n),i>this._columnWidth&&(a=S.AGGREGATED_WIDE_CROPPED,i=this._columnWidth)),(!e||E>i)&&(a=S.AGGREGATED_CROPPED,i=C,n=w),{width:i,height:n,variant:a}},t.prototype._buildMultipageViewMetadata=function(e){var t,n;return n=e.thumbnailUrl,0!==n.indexOf("data:")&&(n=R(n,S.STANDALONE_SCALED)),e.multipageThumbnailUrl&&(t=R(e.multipageThumbnailUrl,S.STANDALONE_SCALED)),{id:e.id,view:r,scaledThumbnailUrl:n,scaledPageUrl:t,attachment:e}},t.prototype._buildStandaloneImageViewMetadata=function(e){var t,n,i,a,r;return i=e.thumbnailUrl,n=this._calculateStandaloneDimensions(e.thumbnailDimensions),r=n.width,t=n.height,a=n.variant,0!==i.indexOf("data:")&&(i=R(i,a)),{id:e.id,view:s,scaledThumbnailUrl:i,width:r,height:t,attachment:e}},t.prototype._calculateStandaloneDimensions=function(e){var t,n,i,a;return a=S.STANDALONE_SCALED,n=i=null,e&&(t=e.width/e.height,e.height<w?(n=e.height,i=e.width):(n=u,i=Math.floor(t*n)),i>this._gridWidth&&(i=this._gridWidth,n=Math.floor(i/t)),d>i&&(a=S.STANDALONE_CROPPED,i=p,n=u)),{width:i,height:n,variant:a}},t}()}),define("modules/clean/recent_activity/react/attachment_multipage_view",["jquery","modules/clean/ajax","modules/core/uri","external/react"],function(e,t,n,i){var a,r,s,o;return o=i.DOM,s=i.addons.classSet,r=i.PropTypes,a=i.createClass({displayName:"AttachmentMultipageView",propTypes:{image:r.shape({thumbnailUrl:r.string.isRequired,browseUrl:r.string,displayName:r.string,width:r.number,height:r.number}),paging:r.string,handleClick:r.func,handleLoadError:r.func},getDefaultProps:function(){return{paging:null,handleClick:function(){},handleLoadError:function(){}}},getInitialState:function(){return{page:1,width:this.props.image.width||null,height:this.props.image.height||null,pageData:null}},componentWillMount:function(){var e,i;return this.props.paging?(e=n.parse(this.props.paging).updateQuery({pagestart:2,pageend:11}).toString(),i={url:e,dataType:"json",success:this._handlePageDataSuccess},i.xhrFields={withCredentials:!0},t.AuthenticatedRequest(i)):void 0},_handlePageDataSuccess:function(e){return e.length>0?this.setState({pageData:e}):void 0},_onMouseMove:function(t){var n,i;if(this.state.pageData)return n=t.pageX-e(t.target).offset().left,i=t.target.clientWidth,this._scrubToPosition(n,i)},_scrubToPosition:function(e,t){var n,i,a,r,s;return a=this.state.pageData.length+1,n=0,i=Math.min(8,Math.floor(t/10)),s=(t-n-i)/a,r=Math.floor((e-n)/s)+1,r>=1&&a>=r&&r!==this.state.page?this.setState({page:r}):void 0},_onMouseLeave:function(){return 1!==this.state.page?this.setState({page:1}):void 0},_onClick:function(e){return e.preventDefault(),this.props.handleClick()},_onError:function(){return this.props.handleLoadError()},_onLoad:function(e){var t;return t=e.target.getBoundingClientRect(),this.setState({width:t.width,height:t.height})},render:function(){var e,t,n,i,a,r;return a=this.state.page||1,this.state.pageData||(a=1),r=1===a?this.props.image.thumbnailUrl:this.state.pageData[a-2],r||(a=1,r=this.props.image.thumbnailUrl),i=this.state.width&&this.state.height&&a>1?o.div({ref:"imgDiv",style:{width:this.state.width,height:this.state.height,backgroundImage:"url('"+r+"')"},className:"attachment-item__doc_further_page"}):o.img({ref:"img",className:"attachment-item__thumbnail",src:r,onError:this._onError,onLoad:this._onLoad}),n=this.state.pageData?o.div({ref:"corner",className:"attachment-item__doc_corner"}):null,t={ref:"anchor",href:this.props.image.browseUrl,onClick:this._onClick,title:this.props.image.displayName,className:"attachment-item__anchor attachment-item__doc_anchor"},this.state.pageData&&(t.onMouseMove=this._onMouseMove,t.onMouseLeave=this._onMouseLeave),this.props.image.width&&this.props.image.height&&(t.style={width:this.props.image.width,height:this.props.image.height}),e=o.a(t,i,n),o.div({className:"attachment-item"},e)}})});var slice=[].slice;define("modules/clean/recent_activity/react/pending_attachment_list_view",["external/underscore","external/react"],function(e,t){var n,i,a,r;return r=t.DOM,a=t.addons.classSet,n=4,i=t.createClass({displayName:"PendingAttachmentListView",propTypes:function(){return{count:t.PropTypes.number.isRequired}},render:function(){var t,i;return i=e.times(Math.min(this.props.count,n),function(){return r.li({className:"attachment-item attachment-item--placeholder"})}),t={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===this.props.count},r.div({className:"recents-item__attachments"},r.ul.apply(r,[{ref:"attachmentsList",className:a(t)}].concat(slice.call(i))))}})}),define("modules/clean/recent_activity/react/recent_activity_blank_slate_view",["external/underscore","external/react","modules/core/i18n","modules/clean/react/button","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/react/recent_activity_onboarding_modal","modules/clean/recent_activity/react/recent_activity_onboarding_view"],function(e,t,n,i,a,r,s,o){var c,l,h,u,d,p,m,_,f,g,v,y,w,I;return v=n._,y=i.button,d=a.Modal,m=r.RECENT_EVENT_FILTER_TYPE,I=t.DOM,w=t.addons.classSet,c=m.ALL,p=m.PHOTOS,g=m.VIDEOS,h=m.DOCUMENTS,l=m.COMMENTS,u=m.JUNK,f=m.UNCATEGORIZED,_=t.createClass({displayName:"RecentActivityBlankSlateView",propTypes:{filter:t.PropTypes.oneOf(e.values(m)).isRequired},_heading:function(){switch(this.props.filter){case c:return v("Pick up where you left off");case p:return v("You don’t have any recent images");case g:return v("You don’t have any recent videos");case h:return v("You don’t have any recent documents");case l:return v("You don’t have any recent comments");case u:return v("You don’t have any other recent files");default:return v("You don’t have any files matching this filter")}},_subheadingMarkup:function(){var e;return e=function(){switch(this.props.filter){case c:return o.onboardingMessageMarkup();case p:return v("When you add or edit an image, you’ll see it here.");case g:return v("When you add or edit a video, you’ll see it here.");case h:return v("When you add or edit an Office document or PDF, you’ll see it here.");case l:return v("When someone comments on one of your documents, you’ll see it here.");case u:return v("You’ll only see unimportant files here, like files created automatically by programs.")}}.call(this),{__html:e}},_filterName:function(){switch(this.props.filter){case c:return"all";case p:return"photos";case g:return"videos";case h:return"documents";case l:return"comments";case u:return"junk"}},render:function(){var e,n,i,a,r;return i=I.h1({ref:"heading",className:"recents-blankslate__heading recents-blankslate--show-image"},this._heading()),r=I.p({ref:"subheading",className:"recents-blankslate__subheading",dangerouslySetInnerHTML:this._subheadingMarkup()}),a=t.createElement(s,{}),e=t.createElement(y,{ref:"button",className:"recents-blankslate__button",onClick:function(){return d.showInstance(a)}},v("Learn about recents")),n=["recents-blankslate","recents-blankslate--"+this._filterName()],I.div({className:w.apply(null,n)},i,r,e)}})}),define("modules/clean/recent_activity/react/recent_activity_editable_field_view",["jquery","external/react","modules/clean/keycode"],function(e,t,n){var i,a,r;return r=t.DOM,a=t.addons.classSet,i=t.createClass({displayName:"RecentActivityEditableField",propTypes:{confirmRenaming:t.PropTypes.func.isRequired,cancelRenaming:t.PropTypes.func.isRequired,name:t.PropTypes.string.isRequired,isRenaming:t.PropTypes.bool},getDefaultProps:function(){return{isRenaming:!1}},componentDidUpdate:function(e){return!e.isRenaming&&this.props.isRenaming?this._selectFilename():void 0},_selectFilename:function(){var e,t;return e=this.props.name,e.lastIndexOf(".")>-1?(t=this.refs.input.getDOMNode(),t.focus(),t.selectionEnd=e.lastIndexOf(".")):void 0},_onRenamingClick:function(e){return e.stopPropagation()},_onRenamingBlur:function(){return this.props.cancelRenaming()},_onRenamingKeyDown:function(e){var t;return e.keyCode===n.ENTER?(t=this.refs.input.getDOMNode().value,t!==this.props.name?this.props.confirmRenaming(t):this.props.cancelRenaming()):e.keyCode===n.ESC?this.props.cancelRenaming():void 0},render:function(){var e;return e={"recents-item__heading":!0,"recents-item__heading--renaming":this.props.isRenaming},this.props.isRenaming?r.input({ref:"input",className:a(e),type:"text",onClick:this._onRenamingClick,onBlur:this._onRenamingBlur,onKeyDown:this._onRenamingKeyDown,defaultValue:this.props.name}):r.div({className:a(e)},this.props.name)}})}),define("modules/clean/recent_activity/react/recent_activity_filter_view",["external/underscore","external/react","modules/core/i18n","modules/clean/react/tabs/tab_nav","modules/clean/react/tabs/tab_util","modules/clean/recent_activity/recent_activity_constants","modules/clean/gandalf_util"],function(e,t,n,i,a,r,s){var o,c,l,h,u,d,p,m,_,f,g,v;return d=r.RECENT_EVENT_FILTER_TYPE,g=n._,v=t.DOM,o=d.ALL,u=d.PHOTOS,_=d.VIDEOS,l=d.DOCUMENTS,c=d.COMMENTS,h=d.JUNK,f=d.VISUAL_NOTES,m=d.UNCATEGORIZED,p=t.createClass({displayName:"RecentActivityFilterView",propTypes:{filter:t.PropTypes.oneOf(e.values(d)),onChange:t.PropTypes.func},render:function(){var n,r;return r=[{label:g("Everything"),value:o},{label:g("Images"),value:u},{label:g("Videos"),value:_},{label:g("Documents"),value:l},{label:g("Other"),value:h,rightAlign:!0}],s.getGandalfRule("recents-web-photos-visual-notes")&&r.push({label:g("Visual Notes"),value:f}),n=Math.max(0,e.pluck(r,"value").indexOf(this.props.filter)),t.createElement(i,{ref:"tabNav",tabs:r,defaultSelectedIndex:n,onChange:this.props.onChange,variant:a.variants.UNDERLINE},this.props.children)}})});var slice=[].slice;define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["external/react","modules/core/i18n","modules/clean/gandalf_util","modules/clean/react/bubble_dropdown","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/unity/features"],function(e,t,n,i,a,r,s){var o,c,l,h;return c=t._,h=e.DOM,l=e.addons.classSet,o=e.createClass({displayName:"RecentActivityItemActionsView",propTypes:{handleShare:e.PropTypes.func,handleOpen:e.PropTypes.func,handleDelete:e.PropTypes.func,handleRename:e.PropTypes.func,handleMove:e.PropTypes.func,handleSelectAll:e.PropTypes.func,handleDeselectAll:e.PropTypes.func,handleReportJunk:e.PropTypes.func,handleDownload:e.PropTypes.func,handleVersions:e.PropTypes.func,handleComment:e.PropTypes.func,selectCount:e.PropTypes.number,attachmentCount:e.PropTypes.number,disableActions:e.PropTypes.bool},getDefaultProps:function(){return{handleShare:function(){},handleOpen:function(){},handleDelete:function(){},handleRename:function(){},handleMove:function(){},handleSelectAll:function(){},handleDeselectAll:function(){},handleReportJunk:function(){},handleDownload:function(){},handleVersions:function(){},handleComment:function(){},selectCount:0,attachmentCount:1,disableActions:!1}},getInitialState:function(){return{tooltipShown:!1}},_ensureEnabled:function(e){return this.props.disableActions?this._onDisabled:e},_onDisabled:function(e){return e.preventDefault()},_onOpen:function(e){return e.preventDefault(),this.props.handleOpen()},_onDelete:function(e){return e.preventDefault(),this.props.handleDelete()},_onRename:function(e){return e.preventDefault(),this.props.handleRename()},_onMove:function(e){return e.preventDefault(),this.props.handleMove()},_onShare:function(e){return e.preventDefault(),this.props.handleShare()},_onSelectAll:function(e){return e.preventDefault(),this.props.handleSelectAll()},_onDeselectAll:function(e){return e.preventDefault(),this.props.handleDeselectAll()},_onDownload:function(e){return e.preventDefault(),this.props.handleDownload()},_onComment:function(e){return e.preventDefault(),this.props.handleComment()},_onVersions:function(e){return e.preventDefault(),this.props.handleVersions()},_onReportJunk:function(e){return e.preventDefault(),this.props.handleReportJunk()},_moreActionHandler:function(e){return function(t){return function(n){return t.refs.moreActionDropdown.hide(),e(n)}}(this)},_onShowTooltip:function(){return this.setState({tooltipShown:!0})},_onHideTooltip:function(){return this.setState({tooltipShown:!1})},_renderMoreActionsList:function(){var t,i,a,o,l,u,d;for(l=[{name:"open",displayName:c("Open"),icon:"open",handler:this._onOpen,shouldShow:function(e){return function(){return s&&e.props.handleOpen}}(this)},{name:"download",displayName:this.props.selectCount>1?c("Download (%(num)s)").format({num:this.props.selectCount}):c("Download"),icon:"download",handler:this._onDownload,shouldShow:function(e){return function(){return e.props.handleDownload}}(this)},{name:"comment",displayName:c("Comment"),icon:"s_file_comment",handler:this._onComment,shouldShow:function(e){return function(){return e.props.handleComment}}(this)},{name:"delete",displayName:this.props.selectCount>1?c("Delete (%(num)s)…").format({num:this.props.selectCount}):c("Delete…"),icon:"delete_16",handler:this._onDelete,shouldShow:function(e){return function(){return e.props.handleDelete}}(this)},{name:"versions",displayName:c("Previous versions"),icon:"previous_versions",handler:this._onVersions,shouldShow:function(e){return function(){return e.props.handleVersions}}(this)},{name:"select",displayName:c("Select all"),icon:"select",handler:this._onSelectAll,shouldShow:function(e){return function(){return e.props.attachmentCount>1&&e.props.selectCount>0&&e.props.selectCount<e.props.attachmentCount}}(this)},{name:"deselect",displayName:c("Deselect all"),icon:"deselect",handler:this._onDeselectAll,shouldShow:function(e){return function(){return e.props.attachmentCount>1&&e.props.selectCount>0}}(this)},{name:"report_junk",displayName:c("Hide this file type (internal)"),icon:"s_disable",handler:this._onReportJunk,shouldShow:function(){return n.getGandalfRule("recents-junk-file-report")}}],u=[],t=0,i=l.length;i>t;t++)o=l[t],o.shouldShow()&&(d=e.createElement(r,{group:"web",name:o.icon,text:o.displayName}),a=h.li({className:"recents-actions-list__item recents-actions-list__item--"+o.name,key:o.name},h.a({onClick:this._moreActionHandler(o.handler),href:"#more"},d)),u.push(a));return u},_renderMoreActionsButton:function(){var t,n,r,s,o;return t=e.createElement(a,{group:"web",name:"more",alt:c("More actions")}),r={"button-secondary":!0,disabled:this.props.disableActions},n=h.a({className:l(r),ref:"moreActions"},t),this.props.disableActions?n:(s=this._renderMoreActionsList(),o=e.createElement(i,{target:n,arrow_position:"top",bubbleDropdownShown:this._onShowTooltip,bubbleDropdownHidden:this._onHideTooltip,ref:"moreActionDropdown"},h.ul({className:"recents-actions-list"},s)))},_renderShareButton:function(){var e;return this.props.handleShare?(e={"recents-item__share-link":!0,"button-secondary":!0,disabled:this.props.disableActions},h.a({ref:"shareLink",className:l(e),href:"#share",onClick:this._ensureEnabled(this._onShare)},c("Share"))):null},_renderSelectAllButton:function(){var e;return e={disabled:this.props.disableActions,"button-secondary":!0,"recents-action-button":!0},h.a({className:l(e),href:"#select-all",onClick:this._ensureEnabled(this._onSelectAll),ref:"selectAllButton"},c("Select all"))},render:function(){var e,t,n,i;return e={"recents-item__actions":!0,"recents-item__actions--disabled":this.props.disableActions,"recents-item__actions--tooltip-shown":this.state.tooltipShown},i=this.props.attachmentCount>1&&0===this.props.selectCount,t=i?[h.div({className:"recents-item__select-all recents-item__action-button"},this._renderSelectAllButton())]:[h.div({className:"recents-item__sharing recents-item__action-button"},this._renderShareButton()),h.div({className:"recents-item__more-actions recents-item__action-button"},this._renderMoreActionsButton())],n=h.div.apply(h,[{className:"recents-item__actions-inner"}].concat(slice.call(t))),h.div({className:l(e)},n)}})});var slice=[].slice;define("modules/clean/recent_activity/react/recent_activity_item_header_view",["external/underscore","external/react","modules/clean/react/sprite","modules/clean/recent_activity/react/recent_activity_editable_field_view","modules/clean/recent_activity/react/recent_activity_item_actions_view"],function(e,t,n,i,a){var r,s,o;return o=t.DOM,s=t.addons.classSet,r=t.createClass({displayName:"RecentActivityItemHeaderView",propTypes:{header:t.PropTypes.shape({icon:t.PropTypes.string,heading:t.PropTypes.node,subheading:t.PropTypes.node}),handleShare:t.PropTypes.func,handleOpen:t.PropTypes.func,handleDelete:t.PropTypes.func,handleRename:t.PropTypes.func,handleSelectAll:t.PropTypes.func,handleDeselectAll:t.PropTypes.func,handleMove:t.PropTypes.func,handleReportJunk:t.PropTypes.func,handleDownload:t.PropTypes.func,handleVersions:t.PropTypes.func,handleComment:t.PropTypes.func,selectCount:t.PropTypes.number,attachmentCount:t.PropTypes.number,disableActions:t.PropTypes.bool,showItemActions:t.PropTypes.bool},getDefaultProps:function(){return{handleShare:function(){},handleOpen:function(){},handleDelete:function(){},handleRename:function(){},handleSelectAll:function(){},handleDeselectAll:function(){},handleMove:function(){},handleReportJunk:function(){},handleDownload:function(){},handleVersions:function(){},handleComment:function(){},selectCount:0,attachmentCount:1,disableActions:!0}},getInitialState:function(){return{isRenaming:!1}},_renderIcon:function(){var i,a,r;return a=this.props.attachmentCount>1?2:1,r=e.times(a,function(e){return function(){return t.createElement(n,{group:"web",name:e.props.header.icon+"_32",alt:""})}}(this)),i={"recents-item__icon":!0,"recents-item__icon--stacked":a>1},o.div.apply(o,[{className:s(i)}].concat(slice.call(r)))},_renderHeading:function(){return t.createElement(i,{confirmRenaming:this._confirmRenaming,cancelRenaming:this._cancelRenaming,name:this.props.header.heading,isRenaming:this.state.isRenaming})},_startRenaming:function(){return this.setState({isRenaming:!0})},_cancelRenaming:function(){return this.setState({isRenaming:!1})},_confirmRenaming:function(e){return this.setState({isRenaming:!1}),e!==this.props.header.heading?this.props.handleRename(e):void 0},_renderActions:function(){return t.createElement(a,{ref:"recentsItemActionsView",handleShare:this.props.handleShare,handleOpen:this.props.handleOpen,handleDelete:this.props.handleDelete,handleRename:this.props.handleRename?this._startRenaming:null,handleMove:this.props.handleMove,handleSelectAll:this.props.handleSelectAll,handleDeselectAll:this.props.handleDeselectAll,handleReportJunk:this.props.handleReportJunk,handleDownload:this.props.handleDownload,handleVersions:this.props.handleVersions,handleComment:this.props.handleComment,disableActions:this.props.disableActions,selectCount:this.props.selectCount,attachmentCount:this.props.attachmentCount})},render:function(){var e,t,n,i,a,r;return i=this._renderHeading(),r=o.div({className:"recents-item__subheading",ref:"subheading"},this.props.header.subheading),a=this._renderIcon(),n=o.div({ref:"recentsItemDetails",className:"recents-item__details"},i,r),t=[a,n],this.props.showItemActions&&(e=this._renderActions(),t.push(e)),o.div.apply(o,[{className:"recents-item__wrapper"}].concat(slice.call(t)))}})});var slice=[].slice;define("modules/clean/recent_activity/react/recent_activity_item_subheader_view",["jquery","external/underscore","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/datetime","modules/clean/em_string","modules/clean/viewer","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n,i,a,r,s,o,c){var l,h,u,d,p,m,_,f,g,v,y;return _=i._,d=c.RECENT_EVENT_TYPES,g=n.DOM,f=n.addons.classSet,h=d.FILE_SHARED_VIEW,l=d.FILE_COMMENT_ADD,m=t.without(t.values(d),h,l),u=100,y=function(e){return Math.floor(1e3*e)},v=function(e){return e/1e3},p=n.createClass({displayName:"RecentActivitySubheaderView",propTypes:{date:n.PropTypes.instanceOf(Date).isRequired,paths:n.PropTypes.arrayOf(n.PropTypes.shape({name:n.PropTypes.string.isRequired,url:n.PropTypes.string.isRequired})).isRequired,type:n.PropTypes.oneOf(t.values(m)).isRequired,handlePathClick:n.PropTypes.func,maxSubheaderWidth:n.PropTypes.number,minPathWidth:n.PropTypes.number,morePathsString:n.PropTypes.string,pathDividerWidth:n.PropTypes.number,viewingUserId:n.PropTypes.number.isRequired},getDefaultProps:function(){return{maxSubheaderWidth:46,minPathWidth:3,morePathsString:"…",pathDividerWidth:1.077}},componentDidMount:function(){return this._bindPathClick()},componentWillUnmount:function(){return this._unbindPathClick()},_bindPathClick:function(){return e(this.getDOMNode()).on("click",".recents-item__subheading-path",this._handlePathClick)},_unbindPathClick:function(){return e(this.getDOMNode()).off("click",".recents-item__subheading-path",this._handlePathClick)},_handlePathClick:function(){return this.props.handlePathClick()},_descString:function(){var e;return e=function(){switch(this.props.type){case d.FILE_ADD:return _("Added %(time_ago)s in %(path)s");case d.FILE_EDIT:return _("Edited %(time_ago)s in %(path)s");case d.FILE_MOVE:return _("Moved %(time_ago)s into %(path)s");case d.FILE_RENAME:return _("Renamed %(time_ago)s in %(path)s");

case d.FILE_RESTORE:return _("Restored %(time_ago)s in %(path)s");case d.FILE_SHARE:return _("Shared %(time_ago)s from %(path)s");case d.FILE_UNSHARE:return _("Unshared %(time_ago)s from %(path)s");case d.FILE_MOUNT:return _("Shared %(time_ago)s from %(path)s");case d.FILE_UNMOUNT:return _("Unshared %(time_ago)s from %(path)s");case d.FILE_PRIVATE_VIEW:return _("Viewed %(time_ago)s in %(path)s");case d.FILE_SHARED_VIEW:return _("Viewed %(time_ago)s in %(path)s");case d.FILE_COMMENT_ADD:return _("Commented %(time_ago)s in %(path)s");default:throw new Error("Unsupported prop type passed to RecentActivitySubheaderView: "+this.props.type)}}.call(this)},_getTotalPathWidth:function(e){var t,n,i,a,r,s;for(s=0,r=y(this.props.pathDividerWidth),t=n=0,i=e.length;i>n;t=++n)a=e[t],s+=a.workingWidth,t<e.length-1&&(s+=r);return s},_createPathMetadata:function(e){var t;return t=new s(e.name).length,{name:e.name,href:e.url,width:t,workingWidth:y(t)}},_getPathsAvailable:function(){return this.props.paths.length>1?this.props.paths.slice(1):this.props.paths},_getPathsToShow:function(){var e,n,i,a,r,c,l,h,d,p,m,_,f,g,w,I,E,b,C,T,S,R,A,P,N;for(n=this._descString().format({time_ago:this._formattedTimestamp(),path:""}),i=y(new s(n).length),g=y(this.props.minPathWidth),E=y(this.props.pathDividerWidth),e=y(this.props.maxSubheaderWidth)-i,N=o.get_viewer(),P=N.get_user_by_id(this.props.viewingUserId),T=[],C=this._getPathsAvailable(),c=h=0,f=C.length;f>h;c=++h)I=C[c],b=this._createPathMetadata(I),T.push(b);for(A=function(){var n;return n=t.last(T),n.width=v(e),n.workingWidth=e,[n]},w=1,l=0;this._getTotalPathWidth(T)>e;){if(l++>u)return A();if(w+1<T.length)a=T[0],R=this._createPathMetadata({name:this.props.morePathsString}),r=[a,R],_=T.slice(w+1,T.length),T=r.concat(_),w++;else{if(1===T.length)return A();for(m=e,c=d=0,S=T.length-1;S>=0?S>d:d>S;c=S>=0?++d:--d)I=T[c],m-=I.workingWidth+E;if(g>m)return A();p=t.last(T),p.width=v(m),p.workingWidth=m}}return T},_formattedTimestamp:function(){return r.ago(this.props.date).toLowerCase()},_renderTimestamp:function(){return g.time({ref:"desc",dateTime:this.props.date.toISOString()},this._formattedTimestamp())},_renderPaths:function(){var e;return e=this._getPathsToShow().map(function(e){var t,n;return n=s.em_snippet(e.name,e.width),t=["recents-item__subheading-path"],e.href?g.a({href:e.href,className:f.apply(null,t)},n):(t.push("recents-item__subheading-path--more"),g.span({className:f.apply(null,t)},n))}),g.span.apply(g,[null].concat(slice.call(e)))},render:function(){var e,t;return e=this._renderPaths(),t=this._renderTimestamp(),g.div({dangerouslySetInnerHTML:{__html:this._descString().format({time_ago:n.renderToString(t),path:n.renderToString(e)})}})}})}),define("modules/clean/recent_activity/react/recent_activity_onboarding_modal",["external/underscore","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/react/button","modules/clean/react/modal"],function(e,t,n,i,a,r){var s,o,c,l,h;return c=n._,l=a.button,s=r.Modal,h=t.DOM,o=t.createClass({displayName:"RecentActivityOnboardingModal",propTypes:{onConfirm:t.PropTypes.func},getDefaultProps:function(){return{onConfirm:function(){}}},_getBrowseInfoMarkup:function(){var t,n,a;return a=i.get_all_browse_roots(),n=a[0],t=a[1],t?c("You can find all your files and folders by going to <span class='recents-onboarding-modal__body__normal'><a href='%(primary_path)s'> %(primary_name)s</a></span> or <span class='recents-onboarding-modal__body__normal'> <a href='%(paired_path)s'>%(paired_name)s</a></span> on the left.").format({primary_name:e.escape(n.name),primary_path:e.escape(n.path),paired_name:e.escape(t.name),paired_path:e.escape(t.path)}):c("You can find all your files and folders by going to <span class='recents-onboarding-modal__body__normal'> <a href='%(path)s'>%(name)s</a></span> on the left.").format({name:e.escape(n.name),path:e.escape(n.path)})},render:function(){var e;return e=this._getBrowseInfoMarkup(),t.createElement(s,{className:"recents-onboarding-modal",style:"clean",acceptButtonText:c("Got it"),onAccept:this.props.onConfirm,autoFocusPrimaryInput:!1},h.div({},h.div({className:"recents-onboarding-modal__header"},h.h1({className:"recents-onboarding-modal__header__text"},c("Getting started with recents"))),h.div({className:"recents-onboarding-modal__body"},h.h2({className:"recents-onboarding-modal__subheader"},c("What’s recents?")),h.p({className:"recents-onboarding-modal__p"},c("Recents is your new Dropbox homepage. It shows files you’ve worked on lately. Your most recent files are at the top, and you can scroll down to see files you worked on earlier.")),h.h2({className:"recents-onboarding-modal__subheader"},c("What can I do with recents?")),h.p({className:"recents-onboarding-modal__p"},c("You can share photos you’ve just taken or work on files you’ve just saved. Recents makes it easy to pick up where you left off last and take quick actions on your recent files.")),h.p({className:"recents-onboarding-modal__p"},c("It’s easy to preview, share, and delete files right from your homepage. You can also see where your files are saved. Look below the file name to see the folder name too.")),h.h2({className:"recents-onboarding-modal__subheader"},c("How do I see all my files and folders?")),h.p({className:"recents-onboarding-modal__p",dangerouslySetInnerHTML:{__html:e}}))))}})}),define("modules/clean/recent_activity/react/recent_activity_onboarding_view",["external/underscore","external/react","modules/core/i18n","modules/clean/browse_interface","modules/clean/react/button","modules/clean/react/modal","modules/clean/recent_activity/react/recent_activity_onboarding_modal"],function(e,t,n,i,a,r,s){var o,c,l,h,u,d;return l=n._,h=a.button,o=r.Modal,d=t.DOM,u=t.addons.classSet,c=t.createClass({statics:{onboardingMessageMarkup:function(){var t,n,a,r;return r=i.get_all_browse_roots(),a=r[0],n=r[1],n?(t=l('Here you’ll see files you’ve worked on recently. You can still find all your files and folders by going to <a href="%(primary_path)s">%(primary_name)s</a> or <a href="%(paired_path)s">%(paired_name)s</a>.'),t=t.format({primary_name:e.escape(a.name),primary_path:e.escape(a.path),paired_name:e.escape(n.name),paired_path:e.escape(n.path)})):(t=l('Here you’ll see files you’ve worked on recently. You can still find all your files and folders by going to <a href="%(path)s">%(name)s</a>.'),t=t.format({name:e.escape(a.name),path:e.escape(a.path)})),t}},displayName:"RecentActivityOnboardingView",propTypes:{onConfirm:t.PropTypes.func},getDefaultProps:function(){return{onConfirm:function(){}}},_getDescMarkup:function(){var e;return e=c.onboardingMessageMarkup(),{__html:e}},render:function(){var e,n,i,a,r,c;return a=d.div({ref:"header",className:"recents-onboarding__header"},l("Pick up where you left off")),i=d.div({ref:"subheader",className:"recents-onboarding__desc",dangerouslySetInnerHTML:this._getDescMarkup()}),r=t.createElement(s,{onConfirm:this.props.onConfirm}),e=t.createElement(h,{ref:"button",className:"recents-onboarding__button",onClick:function(){return o.showInstance(r)}},l("Learn about recents")),n=t.createElement(h,{ref:"confirm",className:"recents-onboarding__confirm",onClick:this.props.onConfirm},l("Got it")),c=d.div({className:"recents-onboarding__wrapper"},a,i,e,n),d.div({className:"recents-onboarding"},c)}})}),define("modules/clean/recent_activity/recent_activity_client",["jquery","external/underscore","modules/clean/ajax","modules/core/exception"],function(e,t,n,i){var a,r,s,o,c,l,h,u,d,p,m,_,f,g,v;return h="ok",o="/recents/json",r="/activity/generate/json",s="/recents/logger",l="/recents/mark_onboarding_as_seen",a="/recents/check_files_in_root_collection",c="/recents/create_collection_shared_link",m=function(e,t){return function(n){return n.status===h?t(n):e.reject(new Error("Payload not okay: "+n))}},p=function(e,t){return function(n,a,r){var s,o,c,l,h,u;return c=function(e){return e.split("\n").map(function(e){return"    "+e}).join("\n")},o="Failed XHR request for "+t+":\nException: "+(null!=(l=r.stack)?l:r)+"\nResponse Status: "+JSON.stringify(n.status)+" "+n.statusText+"\nResponse Headers:\n"+c(n.getAllResponseHeaders()||"[No Headers]")+"\nResponse Body:\n"+c(null!=(h=n.responseText)?h:"[No Body]"),s=new Error(o),s.xhr=n,"abort"!==a&&(u=r instanceof Error?i.SEVERITY.CRITICAL:i.SEVERITY.NONCRITICAL,i.reportException({msg:s,tb:r.stack||s.stack||"",tags:["recents"],severity:u})),e.reject(s)}},f=function(t,i){var a;return a=e.Deferred(),n.WebRequest({url:o,type:"post",subject_user:t,data:{num_activities:20,cursor:i},dataType:"json",success:m(a,function(e){return a.resolve({recentActivities:e.payload.recent_activities,cursor:e.payload.cursor})}),error:p(a,o)}),a.promise()},_=function(i,a){var s;return s=e.Deferred(),n.WebRequest({url:r,type:"post",subject_user:i,data:{activity_keys:JSON.stringify(t.unique(a)),loading_modes:JSON.stringify([])},dataType:"json",success:m(s,function(e){return s.resolve(e.payload.activities_by_activity_key)}),error:p(s,r)}),s.promise()},v=function(e,t){return n.SilentBackgroundRequest({url:s,type:"post",subject_user:e,data:t,error:function(e,t,n){if("abort"!==t)throw new Error("Failed XHR request for "+s+": "+n)}})},g=function(e){return n.WebRequest({url:l,type:"post",subject_user:e,error:function(e,t,n){if("abort"!==t)throw new Error("Failed XHR request for "+l+": "+n)}})},u=function(t,i){var r;return r=e.Deferred(),n.WebRequest({url:a,type:"post",subject_user:t,data:{files_json:JSON.stringify(i)},dataType:"json",success:m(r,function(e){return r.resolve({fileInRootCollectionInfo:e.payload.file_in_root_collection_info})}),error:p(r,a)}),r.promise()},d=function(t,i){var a;return a=e.Deferred(),n.WebRequest({url:c,type:"post",subject_user:t,data:{files_json:JSON.stringify(i)},dataType:"json",success:m(a,function(e){return a.resolve({link:e.payload.link,tkey:e.payload.tkey,shareableItemCount:e.payload.shareable_item_count})}),error:p(a,c)}),a.promise()},{fetchRecentActivities:f,fetchActivitiesByKey:_,postLogEvent:v,markOnboardingAsSeen:g,checkFileInRootCollection:u,createCollectionSharedLink:d}}),define("modules/clean/recent_activity/recent_activity_constants",["modules/constants/python"],function(e){var t,n;return n=e.RECENT_EVENT_TYPES,t=e.RECENT_EVENT_FILTER_TYPE,{RECENT_EVENT_TYPES:n,RECENT_EVENT_FILTER_TYPE:t,ActionTypes:{RECEIVE_RAW_RECENT_ACTIVITIES:"RECEIVE_RAW_RECENT_ACTIVITIES",RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:"RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",RECEIVE_CAN_OPEN_INFO:"RECEIVE_CAN_OPEN_INFO",RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:"RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",DELETE_FILES_PENDING:"DELETE_FILES_PENDING",DELETE_FILES_COMMIT:"DELETE_FILES_COMMIT",DELETE_FILES_ROLLBACK:"DELETE_FILES_ROLLBACK",RENAME_FILE_PENDING:"RENAME_FILE_PENDING",RENAME_FILE_COMMIT:"RENAME_FILE_COMMIT",RENAME_FILE_ROLLBACK:"RENAME_FILE_ROLLBACK",MOVE_FILES_PENDING:"MOVE_FILES_PENDING",MOVE_FILES_COMMIT:"MOVE_FILES_COMMIT",MOVE_FILES_ROLLBACK:"MOVE_FILES_ROLLBACK",SELECT_ATTACHMENTS:"SELECT_ATTACHMENTS",DESELECT_ATTACHMENTS:"DESELECT_ATTACHMENTS"},TransactionPrefixes:{DELETE_FILES:"DELETE_FILES",RENAME_FILE:"RENAME_FILE",MOVE_FILES:"MOVE_FILES"}}}),define("modules/clean/recent_activity/recent_activity_dispatcher",["external/flux"],function(e){var t;return new(t=e.Dispatcher)}),define("modules/clean/recent_activity/recent_activity_logger",["external/underscore","modules/constants/env","modules/core/exception","modules/clean/recent_activity/recent_activity_client"],function(e,t,n,i){var a,r,s,o,c,l,h,u,d,p,m,_,f,g,v,y;return l=t.IS_PROD,f=n.assert,h="client_page_loaded",d="request_failed",s="cell_action",m="time_to_first_action",u=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],p=["failure_type","is_paginated"],o=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],_=["latency","action_type","action_scope"],c={EVERYTHING:"everything",DOCUMENTS:"documents",PHOTOS:"photos",VIDEOS:"videos",OTHER:"other",VISUAL_NOTES:"visual-notes"},r={VIEW:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",MOVE:"move",HIDE:"hide",UNITY_OPEN:"unity_open",RENAME:"rename",OPEN_DIR:"open_dir",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions"},a={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},g=!!l,v=function(t,n,a){return null==a&&(a={}),g?(a=e.clone(a),a.event_name=n,i.postLogEvent(t,a)):void 0},y=function(t,n,i){var a,r,s;return a=e.keys(i),r=e.difference(n,a),f(0===r.length,t+" is missing keys: "+r),s=e.difference(a,n),f(0===s.length,t+" called with unsupported keys: "+s)},{FilterViews:c,ActionTypes:r,ActionScopes:a,enableLogging:function(){return g=!0},disableLogging:function(){return g=!1},isLoggingEnabled:function(){return g},logPageLoaded:function(e,t){return y("logPageLoaded",u,t),v(e,h,t)},logRequestFailed:function(e,t){return y("logRequestFailed",p,t),v(e,d,t)},logCellAction:function(e,t){return y("logCellAction",o,t),v(e,s,t)},logTimeToFirstAction:function(e,t){return y("logTimeToFirstAction",_,t),v(e,m,t)}}}),define("modules/clean/recent_activity/recent_activity_logger_utils",["jquery","external/underscore","modules/core/exception","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,i,a,r){var s,o,c,l,h,u,d,p,m,_,f,g,v,y,w,I,E,b,C;return v=n.assert,m=i.RECENT_EVENT_FILTER_TYPE,s=m.ALL,p=m.PHOTOS,f=m.VIDEOS,h=m.DOCUMENTS,l=m.COMMENTS,d=m.JUNK,g=m.VISUAL_NOTES,_=m.UNCATEGORIZED,u=a.FilterViews,c=a.ActionTypes,o=a.ActionScopes,I=E=!1,y=function(){var t,n;if(t=e(".recents-view .c-tabs__tab.c-tabs__tab--selected"),0===t.length)return u.EVERYTHING;switch(n=t.data("value")){case s:return u.EVERYTHING;case h:return u.DOCUMENTS;case p:return u.PHOTOS;case f:return u.VIDEOS;case d:return u.OTHER;case g:return u.VISUAL_NOTES;default:throw new Error("Unsupported string: "+n+", currentFilterView() may be out of date")}},w=function(e){var t,n;return t=e.getAttribute("datetime"),n=Date.parse(t),v(!isNaN(n),'Invalid datetime attribute <time datetime="'+t+'">'),Math.floor((Date.now()-n)/864e5)},b=function(n,i,r,s,c){var l,h,u,d,p,m;return v(t.isArray(r),"fqPaths must be an Array"),l=e(c.getDOMNode()),h=l.closest(".recents-item"),p=t.uniq(t.map(r,function(e){return e.split(".").pop().toLowerCase()})),m=s>1,u=1===s?o.SINGLE:r.length===s?o.AGGREGATION:o.SUBSET,d={in_aggregation:m,filter_view:y(),action_type:n,action_scope:u,target_activity_type:h.data("item-type"),position:h.prevAll().length,file_extension:p.join(","),days_ago:w(h.find("time")[0])},a.logCellAction(i,d),C(i,t.pick(d,"action_scope","action_type"))},C=function(e,n){return!E&&r.start_time()?(E=!0,n=t.clone(n),n.latency=Date.now()-r.start_time(),a.logTimeToFirstAction(e,n)):void 0},{logShareFile:function(e,t,n,i){return b(c.SHARE,e,[t],n,i)},logShareCollection:function(e,t,n,i){return b(c.SHARE_COLLECTION,e,t,n,i)},logPreviewFiles:function(e,t,n,i){return b(c.VIEW,e,t,n,i)},logDeleteFiles:function(e,t,n,i){return b(c.DELETE,e,t,n,i)},logMoveFiles:function(e,t,n,i){return b(c.MOVE,e,t,n,i)},logUnityOpenFile:function(e,t,n,i){return b(c.UNITY_OPEN,e,[t],n,i)},logRenameFile:function(e,t,n,i){return b(c.RENAME,e,[t],n,i)},logOpenPathUrl:function(e,t,n,i){return b(c.OPEN_DIR,e,t,n,i)},logReportJunk:function(e,t,n,i){return b(c.REPORT_JUNK,e,t,n,i)},logCommentFile:function(e,t,n,i){return b(c.COMMENT,e,[t],n,i)},logDownloadFile:function(e,t,n,i){return b(c.DOWNLOAD,e,t,n,i)},logOpenVersions:function(e,t,n,i){return b(c.VERSIONS,e,[t],n,i)},logRequestFailed:function(e,t){return a.logRequestFailed(e,{failure_type:t.xhr.status,is_paginated:!1})},startRequestTimer:function(){var e,n;return n=Date.now(),e=!1,!I&&r.start_time()&&(e=!0,n=r.start_time(),I=!0),function(i,r){return null==r&&(r={}),r=t.defaults(r,{is_full_page:e}),r.latency=Date.now()-n,a.logPageLoaded(i,r)}},reset:function(){return I=E=!1}}}),define("modules/clean/recent_activity/recent_activity_view_helper",[],function(){var e;return e=function(e){return function(t){var n,i;if(!window.getSelection().toString()){for(n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if("a"===(i=n.nodeName.toLowerCase())||"button"===i)return;n=n.parentNode}return e.apply(this,arguments)}}},{ensureUserIntentToClick:e}}),define("modules/clean/recent_activity/recent_activity_view_models",["external/underscore","external/react","external/immutable","modules/clean/browse_interface","modules/clean/viewer"],function(e,t,n,i,a){var r,s,o,c,l,h,u,d,p,m,_;return o=t.PropTypes,r=n.Record({id:null,displayName:null,viewingUserId:null,browseUrl:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,multipageThumbnailUrl:null,canOpen:!1,inRootCollection:!1}),r.PropTypes=o.shape({id:o.string.isRequired,displayName:o.string.isRequired,viewingUserId:o.number.isRequired,browseUrl:o.string,previewInfo:o.object,fqPath:o.string.isRequired,nsPath:o.string.isRequired,nsId:o.number.isRequired,thumbnailUrl:o.string,thumbnailDimensions:o.object,multipageThumbnailUrl:o.string,canOpen:o["boolean"],inRootCollection:o["boolean"]}),c=n.Record({id:null,type:null,icon:null,when:null,viewingUserId:null,displayName:null,accountDisplayName:null,contextDisplayName:null,filterTypesByKey:{},attachmentIds:n.List(),attachmentsCount:0,paths:n.List(),hasThumbnailAttachments:!1,duplicateIds:n.List(),order:0/0}),c.PropTypes=o.shape({id:o.string.isRequired,type:o.number.isRequired,icon:o.string.isRequired,when:o.number.isRequired,viewingUserId:o.number.isRequired,displayName:o.string.isRequired,accountDisplayName:o.string.isRequired,contextDisplayName:o.string.isRequired,filterTypesByKey:o.object.isRequired,attachmentIds:o.arrayOf(o.string).isRequired,attachmentsCount:o.number.isRequired,paths:o.arrayOf(o.object).isRequired,hasThumbnailAttachments:o.bool.isRequired,duplicateIds:o.arrayOf(o.number).isRequired,order:o.number.isRequired}),s=n.Record({name:null,url:null}),l=n.Record({width:null,height:null}),h=0,u=e.memoize(function(){return h+=1}),m=function(e){var t,i;return i=e.skeleton_data,t=e.activity_key,new c({id:t,type:e.recent_event_type,icon:i.icon,when:e.when_milli,viewingUserId:e.viewing_user.id,displayName:i.display_name,accountDisplayName:i.account_display_name,contextDisplayName:i.context_display_name,filterTypesByKey:Object.freeze(i.filter_types_by_key),attachmentIds:n.List(e.related_activity_keys),attachmentsCount:i.num_related_activities,paths:_(i.fq_path,e.viewing_user.id),hasThumbnailAttachments:i.has_thumbnail,duplicateIds:n.List(e.related_activity_keys).map(function(e){return i.related_activity_dupids_by_activity_key[e]}),order:u(t)})},p=function(e){var t,n,i,a,s,o,c;return i=e.preview_jsinfo||null,(null!=i?i.thumbnail_url_tmpl:void 0)&&(o=i.thumbnail_url_tmpl),(null!=i?i.thumbnail_dimensions:void 0)&&(a=i.thumbnail_dimensions,c=a[0],t=a[1],s=new l({height:t,width:c})),(null!=i?i.multipage_thumbnail_url_tmpl:void 0)&&(n=i.multipage_thumbnail_url_tmpl),new r({id:e.activity_key,viewingUserId:e.viewing_user.id,displayName:e.name,browseUrl:d(e),previewInfo:e.preview_jsinfo,fqPath:e.fq_path,nsPath:e.ns_path,nsId:e.ns_id,thumbnailUrl:o,thumbnailDimensions:s||null,multipageThumbnailUrl:n||null,canOpen:!1,inRootCollection:!1})},_=function(t,r,o){var c,l,h,u,d,p,m;for(null==o&&(o={}),m=a.get_viewer(),p=m.get_user_by_id(r),"/"===t&&(t=""),d=[],u=t.split("/"),o.isDir!==!0&&u.pop();u.length;)h=e.last(u),l=u.join("/"),1===u.length&&""===h&&(h=a.get_root_name(p),l=""),c=i.browse_uri_for_fq_path(p,l).toString(),d.push(new s({name:h,url:c})),u.pop();return n.List(d.reverse())},d=function(e){var t,n,i,a;return a=e.viewing_user.role,e.is_dir?"/"+a+encodeURI(e.fq_path):(i=e.fq_path.split("/"),n=i.pop(),t=i.join("/"),"/"+a+encodeURI(t)+"?select="+encodeURIComponent(n))},{convertRecentActivityToRecentItem:m,convertFileActivityToAttachmentItem:p,getPathsByFqPath:_,PropTypes:{recentItem:c.PropTypes,attachment:r.PropTypes}}});var extend=function(e,t){function n(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/recent_activity/stores/attachment_store",["external/underscore","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/flux/flux_store","modules/clean/recent_activity/transactions","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,a,r,s,o,c){var l,h,u,d,p;return d=n.assert,l=o.ActionTypes,u=o.TransactionPrefixes,p=c.convertFileActivityToAttachmentItem,new(h=function(n){function a(n,i){a.__super__.constructor.call(this,n),this._attachments=t.fromJS(e.object(e.pluck(i,"id"),i)),this._transactionHistory={}}return extend(a,n),a.prototype.getById=function(e){return this._attachments.has(e)?this._attachments.get(e).toJS():null},a.prototype.getByIds=function(n){var i;return i=t.List(n).map(function(e){return function(t){return e._attachments.get(t,null)}}(this)),i.filterNot(e.isNull).toJS()},a.prototype.getByFqPath=function(e){var t;return t=this._attachments.find(function(t){return t.get("fqPath")===e}),t?t.toJS():null},a.prototype.getAll=function(){return this._attachments.toList().toJS()},a.prototype.__onDispatch=function(e){if(!r.handleTransaction(u.DELETE_FILES,e,{onPending:this._onDeleteFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onDeleteFilesRollback.bind(this)})&&!r.handleTransaction(u.RENAME_FILE,e,{onPending:this._onRenameFilePending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onRenameFileRollback.bind(this)})&&!r.handleTransaction(u.MOVE_FILES,e,{onPending:this._onMoveFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onMoveFilesRollback.bind(this)}))switch(e.type){case l.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:return this._onReceiveRawRelatedActivitiesByKey(e);case l.RECEIVE_CAN_OPEN_INFO:return this._onReceiveCanOpenInfo(e);case l.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:return this._onReceiveFileInRootCollectionInfo(e)}},a.prototype._onCommit=function(e){return delete this._transactionHistory[e.transactionId]},a.prototype._onReceiveRawRelatedActivitiesByKey=function(t){return this._attachments=this._attachments.withMutations(function(n){return e.each(t.rawRelatedActivitiesByKey,function(e,t){return n.set(t,p(e))})}),this.__emitChange()},a.prototype._onReceiveCanOpenInfo=function(t){return this._attachments=this._attachments.withMutations(function(n){return e.each(t.canOpenInfo,function(e,t){var i,a,r,s;return s=t.split(":"),a=s[0],r=s[1],(i=n.find(function(e){return e.get("nsId")===Number(a)&&e.get("nsPath")===r}))?n.setIn([i.get("id"),"canOpen"],e.is_locally_available):void 0})}),this.__emitChange()},a.prototype._onReceiveFileInRootCollectionInfo=function(t){return this._attachments=this._attachments.withMutations(function(n){return e.each(t.fileInRootCollectionInfo,function(e,t){var i,a,r,s;return s=t.split(":"),a=s[0],r=s[1],i=n.find(function(e){return e.get("nsId")===Number(a)&&e.get("nsPath")===r}),i?n.setIn([i.get("id"),"inRootCollection"],e):void 0})}),this.__emitChange()},a.prototype._onDeleteFilesPending=function(e){var t;return t=[],this._attachments=this._attachments.withMutations(function(n){var i,a,r,s,o;for(o=e.attachmentIds,a=0,s=o.length;s>a;a++){if(r=o[a],i=n.get(r),!i)return;t.push(i),n.remove(r)}}),this._transactionHistory[e.transactionId]={deletedAttachments:t},this.__emitChange()},a.prototype._onDeleteFilesRollback=function(e){var t;return t=this._transactionHistory[e.transactionId],d(t,"Unable to find data for transaction with id: "+e.transactionId),this._attachments=this._attachments.withMutations(function(e){var n,i,a,r,s;for(r=t.deletedAttachments,s=[],i=0,a=r.length;a>i;i++)n=r[i],s.push(e.set(n.get("id"),n));return s}),this.__emitChange()},a.prototype._onMoveFilesPending=function(t){var n,a,r,s,o;return n=e.pluck(t.attachments,"id"),o=t.transactionId,s=t.toFqPath,a=[],r=[],this._attachments=this._attachments.withMutations(function(e){var t,c,l,h,u,d;for(d=[],c=0,h=n.length;h>c;c++)l=n[c],t=e.get(l),t&&(u=t.merge({id:t.get("id")+o,canOpen:!1,fqPath:s+"/"+i.filename(t.get("fqPath"))}),e.set(u.get("id"),u),e.remove(t.get("id")),a.push(u.get("id")),d.push(r.push(t)));return d}),this._transactionHistory[o]={newAttachmentIds:a,oldAttachments:r},this.__emitChange()},a.prototype._onMoveFilesRollback=function(e){var t;return t=this._transactionHistory[e.transactionId],d(t,"Unable to find data for transaction with id: "+e.transactionId),this._attachments=this._attachments.withMutations(function(e){var n,i,a,r,s,o,c,l,h;for(c=t.newAttachmentIds,i=0,s=c.length;s>i;i++)a=c[i],e.remove(a);for(l=t.oldAttachments,h=[],r=0,o=l.length;o>r;r++)n=l[r],h.push(e.set(n.id,n));return h}),delete this._transactionHistory[e.transactionId],this.__emitChange()},a.prototype._onRenameFilePending=function(e){var t,n,i;return(t=this._attachments.find(function(t){return t.get("fqPath")===e.fqPath}))?(n=t.get("displayName"),i=t.get("fqPath"),this._transactionHistory[e.transactionId]={attachmentId:t.get("id"),originalDisplayName:n,originalFqPath:i},this._attachments=this._attachments.mergeIn([t.get("id")],{fqPath:i.replace(n,e.newDisplayName),displayName:e.newDisplayName}),this.__emitChange()):void 0},a.prototype._onRenameFileRollback=function(e){var t,n;return n=this._transactionHistory[e.transactionId],d(n,"Unable to find data for transaction with id: "+e.transactionId),(t=this._attachments.get(n.attachmentId))?(this._attachments=this._attachments.mergeIn([t.get("id")],{fqPath:n.originalFqPath,displayName:n.originalDisplayName}),delete this._transactionHistory[e.transactionId],this.__emitChange()):void 0},a}(a))(s)});var extend=function(e,t){function n(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/recent_activity/stores/recent_activity_store",["external/underscore","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/flux/flux_store","modules/clean/recent_activity/transactions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/stores/attachment_store"],function(e,t,n,i,a,r,s,o,c,l,h,u){var d,p,m,_,f,g,v,y,w;return v=n.assert,p=s.RECENT_EVENT_FILTER_TYPE,d=c.ActionTypes,g=c.TransactionPrefixes,y=l.convertRecentActivityToRecentItem,w=l.getPathsByFqPath,m=h.RECENT_EVENT_TYPES,_=e.values(p),new(f=function(n){function a(n,i,r){a.__super__.constructor.call(this,n),r=t.fromJS(e.object(e.pluck(r,"id"),r)),this._items=r,this._cursors=t.Map(),this._loaded=t.Set(),this._attachmentStore=i,this._transactionHistory={}}return extend(a,n),a.prototype.getAll=function(){return e.values(this._items.toJS()).sort(function(e,t){return e.when===t.when?e.order-t.order:t.when-e.when})},a.prototype.cursorForUser=function(e){return this._cursors.get(e,null)},a.prototype.isLoadedForUser=function(e){return this._loaded.contains(e)},a.prototype.getById=function(e){var t;return t=this._items.get(e),t?t=t.toJS():null},a.prototype.filterItemsForUser=function(t,n){var i,a,r,s,o;for(v(indexOf.call(_,n)>=0,"filter must be one of "+_),a=this.getAll().filter(function(e){return e.viewingUserId===t}),r=0,o=a.length;o>r;r++)s=a[r],i=e.object(s.attachmentIds,s.duplicateIds),s.attachmentIds=s.attachmentIds.filter(function(e){return function(t){var i;return i=s.filterTypesByKey[t],e._compareFilters(i,n)}}(this)),s.attachmentsCount=s.attachmentIds.length,s.duplicateIds=s.attachmentIds.map(function(e){return i[e]}),s.filterTypesByKey=this._constructFilterTypesByKey(s.filterTypesByKey,n);return a=a.filter(function(e){return e.attachmentsCount}),a.forEach(function(t){return function(n){var i,a,r;return i=t._attachmentStore.getById(n.attachmentIds[0]),i?(a=null!=(r=i.previewInfo)?r.icon.replace(/_32$/,""):void 0,n.icon=e.unique(e.values(n.filterTypesByKey)).length>1||!a?"page_white":a,n.displayName=i.displayName):void 0}}(this)),a},a.prototype.__onDispatch=function(e){if(!r.handleTransaction(g.DELETE_FILES,e,{onPending:this._onDeleteFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onDeleteFilesRollback.bind(this)})&&!r.handleTransaction(g.RENAME_FILE,e,{onPending:this._onRenameFilePending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onRenameFileRollback.bind(this)})&&!r.handleTransaction(g.MOVE_FILES,e,{onPending:this._onMoveFilesPending.bind(this),onCommit:this._onCommit.bind(this),onRollback:this._onMoveFilesRollback.bind(this)}))switch(e.type){case d.RECEIVE_RAW_RECENT_ACTIVITIES:return this._onReceiveRawRecentActivities(e);case d.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:return this._onReceiveRawRelatedActivitiesByKey(e)}},a.prototype._onCommit=function(e){return delete this._transactionHistory[e.transactionId]},a.prototype._onReceiveRawRecentActivities=function(e){var t;return t=e.rawRecentActivities.map(y),this._items=this._items.withMutations(function(e){return t.forEach(function(t){return e.set(t.get("id"),t)})}),this._loaded=this._loaded.add(e.userId),this._cursors=this._cursors.set(e.userId,e.cursor),this.__emitChange()},a.prototype._onReceiveRawRelatedActivitiesByKey=function(e){return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),this._items=this._items.withMutations(function(t){return function(n){var i,a,r,s,o,c,l,h,u,d;for(d=e.recentActivityKeys,s=0,l=d.length;l>s;s++){if(o=d[s],c=n.get(o),!c)return;if(i=c.get("attachmentIds"),!i)return;a=t._attachmentStore.getById(i.first()),r=a.fqPath,i.slice(1).forEach(function(e){var n;return n=t._attachmentStore.getById(e),n.fqPath.split("/").length<r.split("/").length?r=n.fqPath:void 0}),u=r.split("/"),h=u[u.length-2],h&&n.setIn([o,"contextDisplayName"],h),n.setIn([o,"paths"],w(r,c.get("viewingUserId")))}}}(this)),this.__emitChange()},a.prototype._onDeleteFilesPending=function(e){return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),this._transactionHistory[e.transactionId]=this._deleteAttachments(e.attachmentIds),this.__emitChange()},a.prototype._onDeleteFilesRollback=function(e){var t;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),t=this._transactionHistory[e.transactionId],v(t,"Unable to find data for transaction with id: "+e.transactionId),delete this._transactionHistory[e.transactionId],this._rollbackDelete(t),this.__emitChange()},a.prototype._onMoveFilesPending=function(n){var i,a,r,s,o,c,l,h;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),i=e.pluck(n.attachments,"id"),h=n.transactionId,s=n.itemId,l=n.toFqPath,r=this._items.get(s),r&&(o=i.map(function(e){return function(t){return e._attachmentStore.getById(t+h)}}(this)),o.length)?(c=r.merge({id:h,type:m.FILE_MOVE,when:Date.now(),attachmentIds:t.List(e.pluck(o,"id")),attachmentsCount:o.length,paths:t.fromJS(w(o[0].fqPath,r.get("viewingUserId")))}),a=this._deleteAttachments(i),this._items=this._items.set(h,c),this._transactionHistory[h]={id:c.get("id"),deletedRollbackData:a},this.__emitChange()):void 0},a.prototype._onMoveFilesRollback=function(e){var t;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),t=this._transactionHistory[e.transactionId],v(t,"Unable to find data for transaction with id: "+e.transactionId),delete this._transactionHistory[e.transactionId],
this._items.has(t.id)&&(this._items=this._items["delete"](t.id)),this._rollbackDelete(t.deletedRollbackData),this.__emitChange()},a.prototype._deleteAttachments=function(n){var i;return i=null,this._items=this._items.withMutations(function(a){var r,s,o;return(r=a.find(function(e){return e.get("attachmentIds").indexOf(n[0])>-1}))?(s=r.get("id"),o=e.difference(r.get("attachmentIds").toArray(),n),a.mergeIn([s],{attachmentIds:t.List(o),attachmentsCount:o.length}),i={deletedAttachmentIds:n,item:a.get(s)},0===o.length?a["delete"](s):void 0):void 0}),i},a.prototype._rollbackDelete=function(e){return this._items=this._items.withMutations(function(n){var i,a,r;return a=e.item.get("id"),i=n.get(a),i||(i=e.item,i=i.setIn(["attachmentIds"],t.List())),r=i.get("attachmentIds").concat(e.deletedAttachmentIds),i=i.merge({attachmentIds:r,attachmentsCount:r.size}),n.set(a,i)})},a.prototype._onRenameFilePending=function(e){var t,n,a,r;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),t=e.fqPath.replace(i.filename(e.fqPath),e.newDisplayName),n=this._attachmentStore.getByFqPath(t),n&&(a=this._items.find(function(e){return e.get("attachmentIds").indexOf(n.id)>-1}),a&&a.get("attachmentIds").first()===n.id)?(r=a.get("id"),this._transactionHistory[e.transactionId]={id:r,originalDisplayName:a.get("displayName")},this._items=this._items.setIn([r,"displayName"],e.newDisplayName),this.__emitChange()):void 0},a.prototype._onRenameFileRollback=function(e){var t,n;return this.getDispatcher().waitFor([this._attachmentStore.getDispatchToken()]),n=this._transactionHistory[e.transactionId],v(n,"Unable to find data for transaction with id: "+e.transactionId),delete this._transactionHistory[e.transactionId],(t=this._items.get(n.id))?(this._items=this._items.setIn([n.id,"displayName"],n.originalDisplayName),this.__emitChange()):void 0},a.prototype._compareFilters=function(e,t){var n;return n=t===p.ALL&&e!==p.JUNK,t===e||n},a.prototype._constructFilterTypesByKey=function(e,t){var n,i,a;a={};for(n in e)i=e[n],this._compareFilters(i,t)&&(a[n]=i);return a},a}(a))(o,u)});var extend=function(e,t){function n(){this.constructor=e}for(var i in t)hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;define("modules/clean/recent_activity/stores/selection_store",["external/underscore","external/immutable","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n,i,a){var r,s;return r=a.ActionTypes,new(s=function(e){function n(e,i,a){null==i&&(i=null),null==a&&(a=[]),n.__super__.constructor.call(this,e),this._selected=t.Set(a),this._recentItemId=i}return extend(n,e),n.prototype.getByRecentItemId=function(e){return e===this._recentItemId?this._selected.toArray():[]},n.prototype.__onDispatch=function(e){switch(e.type){case r.SELECT_ATTACHMENTS:return this._onReceiveSelectAttachments(e);case r.DESELECT_ATTACHMENTS:return this._onReceiveDeselectAttachments(e)}},n.prototype._onReceiveSelectAttachments=function(e){return this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.concat(e.attachmentIds),this.__emitChange()},n.prototype._onReceiveDeselectAttachments=function(e){return this._recentItemId!==e.recentItemId&&(this._recentItemId=e.recentItemId,this._selected=this._selected.clear()),this._selected=this._selected.filter(function(t){return-1===e.attachmentIds.indexOf(t)}),this.__emitChange()},n}(n))(i)}),define("modules/clean/recent_activity/transactions",["external/underscore"],function(e){var t,n;return n=function(){},t={onPending:n,onCommit:n,onRollback:n},{createTransaction:function(t,n){var i,a;return a=e.uniqueId(t+"_"),i=function(t){return function(i){return i=e.extend({type:t,transactionId:a},i),n.dispatch(i)}},{pending:i(t+"_PENDING"),commit:i(t+"_COMMIT"),rollback:i(t+"_ROLLBACK")}},handleTransaction:function(n,i,a){switch(a=e.extend(t,a),i.type){case n+"_PENDING":a.onPending(i);break;case n+"_COMMIT":a.onCommit(i);break;case n+"_ROLLBACK":a.onRollback(i);break;default:return!1}return!0}}}),define("modules/dirty/recent_activity/actions/recent_activity_actions",["dropbox","external/underscore","external/react","modules/core/exception","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/downloads","modules/clean/gandalf_util","modules/clean/viewer","modules/clean/recent_activity/transactions","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_view_models","modules/clean/react/modal","modules/clean/unity/features","modules/dirty/react/file_viewer/controller","modules/constants/python"],function(e,t,n,i,a,r,s,o,c,l,h,u,d,p,m,_,f,g,v,y,w,I){var E,b,C,T,S,R,A,P,N,D,O,k,L,M,F,V,U;return S=r._,U=r.ungettext,E=m.ActionTypes,T=m.TransactionPrefixes,F=g.getPathsByFqPath,b=v.Modal,C=v.SimpleModal,M=i.assert,D=function(e,n){var i,a,r,s,o,c;for(c=n.recentActivities,i=n.cursor,r=[],a=0,s=c.length;s>a;a++)o=c[a],r=r.concat(o.related_activity_keys);return u.fetchActivitiesByKey(e,r).then(function(n){var i;return d.dispatch({type:E.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,recentActivityKeys:t.pluck(c,"activity_key"),rawRelatedActivitiesByKey:n}),i=y&&t.all(t.pluck(c,"is_unity_allowed")),i&&R(n,e),A(n,e),n})},L=function(e,t){return d.dispatch({type:E.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t.recentActivities,cursor:t.cursor,userId:e})},R=function(e,t){var n,i,a;if(e){i=[];for(a in e)n=e[a],i.push({ns_id:n.ns_id,ns_path:n.ns_path});return P(i,t).then(function(e){return d.dispatch({type:E.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}},P=function(e,t){return y.check_file_batch(e,t,function(){})},A=function(e,t){var n,i,a;if(e){i=[];for(a in e)n=e[a],i.push({ns_id:n.ns_id,ns_path:n.ns_path});return u.checkFileInRootCollection(t,i).then(function(e){return d.dispatch({type:E.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}},k=function(n,i,a){var r;return r=l.get_viewer().get_user_by_id(n),a=t.defaults({},a,{index:0,shouldFocusCommentInput:!1}),c.getGandalfRule("file-viewer-react")?w.open(i,a.index,r,"react-file-viewer",{disableRouting:!0,oref:Constants.OREF_CONSTANTS.RECENTS,fileViewMode:I.FileViewModeType.BROWSE,fileViewContext:I.FileViewContextType.PRIVATE,shouldFocusCommentInput:a.shouldFocusCommentInput}):e.FileViewer.show(i[a.index],r,{files:i,should_focus_comment_input:a.shouldFocusCommentInput},Constants.OREF_CONSTANTS.RECENTS)},N=function(e,n){var i,a,r,s;return null==n&&(n=null),i=f.startRequestTimer(),a=f.logRequestFailed.bind(null,e),s=u.fetchRecentActivities(e,n),s.then(t.partial(L,e),a),r=s.then(t.partial(D,e)).then(null,a),s.then(function(a){var s;return s=a.recentActivities,r.then(function(){var a;return a=t.map(s,function(e){return e.skeleton_data.num_related_activities}),i(e,{is_paginated:!!n,contains_aggregation:t.any(a,function(e){return e>1}),item_count:t.reduce(a,function(e,t){return e+t},0)})})})},O=function(n,i,a){var r,o,c,l;return l=h.createTransaction(T.MOVE_FILES,d),c=function(){var e,t;return e=F(a,n.viewingUserId,{isDir:!0}).last().name,t=U("Moved %(file_count)s item to %(destination)s","Moved %(file_count)s items to %(destination)s",i.length).format({file_count:i.length,destination:e}),s.success(t),l.commit()},o=function(){var e;return e=S("We were unable move these files. If the problem continues please contact support@dropbox.com"),1===i.length&&(e=S("We were unable move this file. If the problem continues please contact support@dropbox.com")),s.error(e),l.rollback()},r=t.pluck(i,"fqPath"),e.FileOps.do_nonbrowse_move(n.viewingUserId,r,a).then(c,o),l.pending({itemId:n.id,attachments:i,toFqPath:a})},V={promptAndDeleteAttachments:function(n,i,a){var r,s,o;return null==a&&(a=null),M(n.length>0,"promptAndDeleteAttachments expects at least one attachment"),M(i,"promptAndDeleteAttachments expects a viewingUserId to be provided"),r=function(){var a,r,s;return a=t.pluck(n,"id"),s=h.createTransaction(T.DELETE_FILES,d),r=t.pluck(n,"fqPath"),s.pending({attachmentIds:a}),e.FileOps.do_nonbrowse_delete(i,r).then(s.commit,s.rollback)},1===n.length?(o=S("Delete file?"),s=S("Do you want to delete <b>%(file_name)s</b>?").format({file_name:t.escape(n[0].displayName)})):(o=S("Delete files?"),s=S("Do you want to delete <b>%(num)s files</b>?").format({num:t.escape(n.length)})),C.show({title_text:o,body_html:s,confirm_text:S("Delete"),confirm_callback:r,cancel_text:S("Cancel"),autoclose:!0}),null!=a?f.logDeleteFiles(a.viewingUserId,a.fqPaths,a.totalCount,a.cellView):void 0},renameAttachment:function(t,n,i,a){var r,o;return null==a&&(a=null),o=h.createTransaction(T.RENAME_FILE,d),o.pending({fqPath:n,newDisplayName:i}),r=function(){return s.error(S("Sorry, we couldn’t rename this file. Please try again.")),o.rollback()},e.FileOps.do_nonbrowse_rename(t,n,i).then(o.commit,r),null!=a?f.logRenameFile(a.viewingUserId,a.fqPath,a.totalCount,a.cellView):void 0},loadPage:function(e){return N(e)},loadNextPage:function(e){var t;return t=p.cursorForUser(e),t&&N(e,t),!!t},shareFile:function(t,n,i){return null==i&&(i=null),new e.ShareLinkModal(t,n).show(),null!=i?f.logShareFile(i.viewingUserId,i.fqPath,i.totalCount,i.cellView):void 0},shareCollection:function(t,n,i){var a,r;return null==i&&(i=null),a=function(){var e,t,i;for(i=[],e=0,t=n.length;t>e;e++)r=n[e],i.push({ns_id:r.nsId,ns_path:r.nsPath});return i}(),u.createCollectionSharedLink(t,a).then(function(n){var i;return n.shareableItemCount<a.length&&(i=a.length-n.shareableItemCount,s.error(U("%(missing)s file can’t be shared.","%(missing)s files can’t be shared.",i).format({missing:i}))),new e.ShareLinkModal(t,null,null,!1,n.tkey).show()}),null!=i?f.logShareCollection(i.viewingUserId,i.fqPaths,i.totalCount,i.cellView):void 0},browseFile:function(e){return a.redirect(e)},previewFiles:function(e,t,n,i){return k(e,t,n),null!=i?n.shouldFocusCommentInput?f.logCommentFile(i.viewingUserId,i.fqPaths,i.totalCount,i.cellView):f.logPreviewFiles(i.viewingUserId,i.fqPaths,i.totalCount,i.cellView):void 0},openFile:function(e,n,a,r){var o;return null==r&&(r=null),M(y,"Unity is not supported by this browser"),o=function(e){return s.error("Sorry, we were unable to open this file"),i.reportException({msg:e,tb:e.stack||"",tags:["recents"],severity:i.SEVERITY.NONCRITICAL})},y.open_file(e,n,a,t.noop,o),null!=r?f.logUnityOpenFile(r.viewingUserId,r.fqPath,r.totalCount,r.cellView):void 0},markOnboardingAsSeen:function(e){return u.markOnboardingAsSeen(e)},promptAndMoveAttachments:function(t,i,a){var r,s,o,c,h,u,d,p,m;return null==a&&(a=null),M(i.length>0),d=null,m=l.get_viewer().get_user_by_id(t.viewingUserId),u=function(){var e;return e=$j("#treeview"),$j("#treeview-mount-point").append(e)},r=function(){return M(d,"Move file confirmed without selecting a file"),u(),O(t,i,d)},s=function(e,t){return d=e,$j("#treeview").find(".highlight").removeClass("highlight"),$j(t).parent().addClass("highlight"),c.setProps({acceptButtonDisabled:!1})},o=function(){return e.TreeView.init(s,!1,"treeview-modal-mount-point"),e.TreeView.set_params({disable_read_only:!0}),e.TreeView.reset({user:m}),e.TreeView.move("treeview","treeview-modal-mount-point",{user:m})},p=U("Move %(file_count)s file to…","Move %(file_count)s files to…",i.length),1===i.length&&(p=S("Move file to…")),h=n.createElement(b,{title:p.format({file_count:i.length}),acceptButtonText:S("Move"),acceptButtonDisabled:!0,onAccept:r,dismissButtonText:S("Cancel"),onDismiss:u,autoClose:!0,onShow:o},n.DOM.div({id:"treeview-modal-mount-point"})),c=b.showInstance(h),null!=a?f.logMoveFiles(a.viewingUserId,a.fqPaths,a.totalCount,a.cellView):void 0},notifyAndLogReportJunk:function(e,t,n){return s.success(S("Report received. Thank you!"),3),f.logReportJunk(e,t,n)},selectAttachments:function(e,t){return d.dispatch({type:E.SELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})},deselectAttachments:function(e,t){return d.dispatch({type:E.DESELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})},downloadFiles:function(e,t,n){return null!=n&&f.logDownloadFile(n.viewingUserId,n.fqPaths,n.totalCount,n.cellView),t.map(function(e){var t,n;return n=null!=(t=e.previewInfo)?t.direct_blockserver_link:void 0,n?o.get_blockserver_link({url:n}):void 0})},openVersions:function(t,n,i){var r;return null!=i&&f.logOpenVersions(i.viewingUserId,i.fqPath,i.totalCount,i.cellView),r=e.FileOps.build_revisions_uri(n,t),a.redirect(r.toString())}}}),define("modules/dirty/recent_activity/react/attachment_list_view",["jquery","external/underscore","external/react","modules/core/exception","modules/core/i18n","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_multipage_view","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_logger_utils","modules/dirty/recent_activity/actions/recent_activity_actions"],function(e,t,n,i,a,r,s,o,c,l,h,u,d,p,m){var _,f,g,v,y,w,I,E,b,C;return I=i.assert,w=a._,C=r.thumbnailUrlForSize,y=r.ThumbnailSizeMode,b=n.DOM,E=n.addons.classSet,v=n.PropTypes,g=d.PropTypes,_=4,f=n.createClass({displayName:"AttachmentListView",propTypes:{attachments:v.arrayOf(g.attachment).isRequired,duplicateIds:n.PropTypes.arrayOf(n.PropTypes.number).isRequired,selectedAttachmentIds:v.array,handleToggleSelect:v.func},componentDidMount:function(){return this._updateLayoutController()},componentWillReceiveProps:function(e){return this._isAllSelected(e)?this.setState({rows:1/0}):void 0},componentDidUpdate:function(){return this._updateLayoutController()},getInitialState:function(){return{rows:this._isAllSelected(this.props)?1/0:1,errored:[],containerWidth:null,expandedAttachments:{}}},getDefaultProps:function(){return{handleToggleSelect:function(){},selectedAttachmentIds:[]}},_isAllSelected:function(e){return t.size(e.selectedAttachmentIds)===e.attachments.length},_updateLayoutController:function(){var t,n,i,a;return t=e(this.refs.attachmentsList.getDOMNode()),n=t.innerWidth(),n!==this.state.containerWidth?(i=Math.abs(parseFloat(t.css("margin-left")))||0,a=Math.floor(n/2)-i,this._layoutController=u.create(n,a,i),this.setState({containerWidth:n})):void 0},_previewAttachment:function(e){var n,i,a,r;return n=t.findWhere(this.props.attachments,{id:e}),r=n.viewingUserId,i=t.pluck(this.props.attachments,"previewInfo"),a={viewingUserId:r,fqPaths:[n.fqPath],cellView:this},m.previewFiles(r,i,{index:this.props.attachments.indexOf(n),shouldFocusCommentInput:!1},a)},_expandStack:function(e){var n,i,a,r,s,o,c,l,h;for(n=this._dedupeMetadata(),o=t.find(n,function(t){return t.attachment.id===e}),i=t.clone(this.state.expandedAttachments),r=this.props.attachments.indexOf(o.attachment),h=o.stackLength,a=s=c=r,l=r+h;l>=c?l>s:s>l;a=l>=c?++s:--s)i[this.props.attachments[a].id]=e;return this.setState({expandedAttachments:i})},_collapseStack:function(e){var n,i,a,r,s,o,c,l,h,u;for(a=this.state.expandedAttachments[e],n=this._dedupeMetadata(),c=t.find(n,function(e){return e.attachment.id===a}),i=t.clone(this.state.expandedAttachments),s=this.props.attachments.indexOf(c.attachment),u=c.stackLength,r=o=l=s,h=s+u;h>=l?h>o:o>h;r=h>=l?++o:--o)delete i[this.props.attachments[r].id];return this.setState({expandedAttachments:i})},_handleImageToggleSelect:function(e,n){var i;return i=t.findWhere(this.props.attachments,{id:e}),this.props.handleToggleSelect(i,n)},_handleImageLoadError:function(e){var t;return t=this.state.errored.slice(),t.push(e),this.setState({errored:t})},_revealNextGroup:function(){return this.setState({rows:this.state.rows+_})},_renderFileIconView:function(e,t,i){var a;return a=e.attachment,n.createElement(h,{key:"attachment-"+e.id,id:e.id,file:{icon:a.previewInfo.icon,displayName:a.displayName,browseUrl:a.browseUrl},overlayText:t,handleClick:i,showCheckmark:this.props.attachments.length>1&&!t,handleToggleSelect:this._handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(a.id)>-1})},_renderStackedImageView:function(e,t,i){var a,r;return a=e.attachment,r=this._propsForImageView(e,i),r.key="attachment-stacked-"+e.id,r.handleClick=this._expandStack,r.handleCornerClick=this._expandStack,r.stackLength=t,n.createElement(c,r)},_renderExpandedImageView:function(e,t,i){var a,r;return a=e.attachment,r=this._propsForImageView(e,i),r.showCheckmark=this.props.attachments.length>1,r.handleCornerClick=this._collapseStack,n.createElement(l,r)},_renderImageView:function(e,t,i){var a,r;return a=e.attachment,r=this._propsForImageView(e,i),r.key="attachment-expanded-"+e.id,r.overlayText=t,r.showCheckmark=this.props.attachments.length>1&&!t,n.createElement(o,r)},_propsForImageView:function(e,t){var n,i,a;return n=e.attachment,i="video"===(null!=(a=n.previewInfo)?a.preview_type:void 0),{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,browseUrl:n.browseUrl,displayName:n.displayName,width:e.width,height:e.height},badgeType:i?o.BadgeType.VIDEO:void 0,handleClick:t,handleLoadError:this._handleImageLoadError,handleToggleSelect:this._handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(n.id)>-1}},_renderMultipageView:function(e,t,i){var a;return a=e.attachment,n.createElement(s,{key:"attachment-"+e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,browseUrl:a.browseUrl,displayName:a.displayName},paging:e.scaledPageUrl,handleClick:i,handleLoadError:this._handleImageLoadError})},_dedupeMetadata:function(){var e,t,n,i,a,r,s,o,c,l,h,u,d,p,m,_,f,g,v;if(n=[],i={},t={},v={},this.props.duplicateIds)for(m=this.props.attachments,r=h=0,d=m.length;d>h;r=++h)e=m[r],a=this.props.duplicateIds[r],a in i||(i[a]=[],v[e.id]=e),i[a].push(e),t[e.id]=i[a];for(_=this.props.attachments,u=0,p=_.length;p>u;u++)e=_[u],o=e.id in this.state.expandedAttachments,g=null!=(f=t[e.id])?f.length:void 0,c=e.id in v,l=g>1&&c,s=g>1&&!c,(!s||o)&&n.push({attachment:e,stackLength:g,isParentOfStack:c,isStacked:l,isExpanded:o});return n},_renderAttachmentItems:function(){var e,n,i,a,r,c,l,u,d,p,m,_,f,g,v,y,E,C,T,S,R;return this.state.containerWidth?(i=this._dedupeMetadata(),n=t.pluck(i,"attachment"),a=this._layoutController.generate(n,this.state.rows,this.state.errored),e=t.flatten(a),r=this._previewAttachment,R=e.length,S=n.length,C=S-R+1,p=S>R,f=function(){var t,n,a;for(a=[],c=t=0,n=e.length;n>t;c=++t)switch(v=e[c],d=c===e.length-1,_=i[c].isStacked,m=i[c].isParentOfStack,u=i[c].isExpanded,T=i[c].stackLength,d&&p&&(r=this._revealNextGroup,y=w("+%(count)s").format({count:C})),g="attachment-item-"+v.attachment.id,E={key:g},v.view){case h:a.push(b.li(E,this._renderFileIconView(v,y,r)));break;case o:l=p&&d,a.push(T>1&&!l?m&&u?b.li(E,this._renderImageView(v,y,r)):_&&!u?b.li(E,this._renderStackedImageView(v,T,r)):u?b.li(E,this._renderExpandedImageView(v,y,r)):void 0:b.li(E,this._renderImageView(v,y,r)));break;case s:a.push(b.li(E,this._renderMultipageView(v,y,r)));break;default:a.push(I(!1,v.view.displayName+" is not supported by AttachmentListView"))}return a}.call(this)):[]},render:function(){var e,t,n,i;return i=this._renderAttachmentItems(),n=1===i.length,t=1===this.state.errored.length,e={"attachment-list":!0,"attachment-list--standalone":n&&!t},b.div({className:"recents-item__attachments"},b.ul({ref:"attachmentsList",className:E(e)},i))}})}),define("modules/dirty/recent_activity/react/doc_attachment_list_view",["jquery","external/underscore","external/react","modules/core/i18n","modules/dirty/recent_activity/react/doc_attachment_view","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,a,r){var s,o,c,l,h,u,d,p;return u=i._,p=n.DOM,d=n.addons.classSet,h=n.PropTypes,l=r.PropTypes,s=10,o=n.createClass({displayName:"DocAttachmentListView",propTypes:{recentItem:l.recentItem,attachments:h.arrayOf(l.attachment)},getInitialState:function(){return{numberOfRows:3}},_revealNextGroup:function(){return this.setState({numberOfRows:this.state.numberOfRows+s})},_renderFileView:function(e){return n.createElement(a,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem})},_renderLoadMoreView:function(e){return n.createElement(c,{key:"attachment-load-more",handleClick:this._revealNextGroup,numToShow:e})},_renderAttachmentItems:function(){var e,t,n,i,a;return t=this.props.attachments.slice(0,this.state.numberOfRows),i=this.props.attachments.length-t.length,n=function(){var n,i,a;for(a=[],n=0,i=t.length;i>n;n++)e=t[n],a.push(this._renderFileView(e));return a}.call(this),i>0&&(a=Math.min(i,s),n.push(this._renderLoadMoreView(a))),n},render:function(){var e,t;return e=this._renderAttachmentItems(),t=null,this.props.attachments&&0!==this.props.attachments.length&&(t=p.div({className:"doc-attachment-list__spacer"})),p.div({className:"recents-item__doc-attachments"},t,p.ul({ref:"attachmentsList",className:"doc-attachment-list"},e))}}),c=n.createClass({displayName:"DocAttachmentLoadMoreView",propTypes:{handleClick:n.PropTypes.func,numToShow:n.PropTypes.number.isRequired},getDefaultProps:function(){return{handleClick:function(){}}},_onClick:function(e){return e.preventDefault(),this.props.handleClick()},render:function(){return p.li({key:"attachment-load-more",className:"doc-attachment-item--load-more"},p.a({onClick:this._onClick,ref:"loadMoreText"},u("Show %(num)s more").format({num:this.props.numToShow})))}}),{DocAttachmentListView:o,DocAttachmentLoadMoreView:c}}),define("modules/dirty/recent_activity/react/doc_attachment_view",["external/underscore","external/react","modules/core/exception","modules/clean/em_string","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/dirty/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_view_models"],function(e,t,n,i,a,r,s,o,c,l){var h,u,d,p,m,_;return d=n.assert,_=c.ensureUserIntentToClick,m=t.DOM,p=t.addons.classSet,u=l.PropTypes,h=t.createClass({displayName:"DocAttachmentView",propTypes:{recentItem:u.recentItem,attachment:u.attachment},_handleShare:function(){var e;return e=this.props.attachment.viewingUserId,s.shareFile(e,this.props.attachment.fqPath,{viewingUserId:e,fqPath:this.props.attachment.fqPath,totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_handleOpen:function(){return d(this.props.attachment.canOpen,"This item does not support opening"),s.openFile(this.props.attachment.nsId,this.props.attachment.nsPath,this.props.attachment.viewingUserId,{viewingUserId:this.props.attachment.viewingUserId,fqPath:this.props.attachment.fqPath,totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_handleDelete:function(){return s.promptAndDeleteAttachments([this.props.attachment],this.props.attachment.viewingUserId,{viewingUserId:this.props.attachment.viewingUserId,fqPaths:[this.props.attachment.fqPath],totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_handleRename:function(e){return s.renameAttachment(this.props.attachment.viewingUserId,this.props.attachment.fqPath,e,{viewingUserId:this.props.attachment.viewingUserId,fqPath:this.props.attachment.fqPath,totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_previewOrOpenFiles:function(t){return e.isObject(this.props.attachment.previewInfo)&&!e.isEmpty(this.props.attachment.previewInfo)?s.previewFiles(this.props.attachment.viewingUserId,[this.props.attachment.previewInfo],{index:0,shouldFocusCommentInput:t},{viewingUserId:this.props.attachment.viewingUserId,fqPaths:[this.props.attachment.fqPath],totalCount:this.props.recentItem.attachmentsCount,cellView:this}):s.browseFile(this.props.attachment.browseUrl)},_handleMove:function(){return s.promptAndMoveAttachments(this.props.recentItem,[this.props.attachment],{viewingUserId:this.props.recentItem.viewingUserId,fqPaths:[this.props.attachment.fqPath],totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_handleReportJunk:function(){return s.notifyAndLogReportJunk(this.props.attachment.viewingUserId,[this.props.attachment.fqPath],this)},_handleDownload:function(){var e;return e=this.props.recentItem.viewingUserId,s.downloadFiles(e,[this.props.attachment],{viewingUserId:this.props.recentItem.viewingUserId,fqPaths:[this.props.attachment.fqPath],totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_handleComment:function(){return this._previewOrOpenFiles(!0)},_handleVersions:function(){var e;return e=this.props.recentItem.viewingUserId,s.openVersions(e,this.props.attachment.fqPath,{viewingUserId:this.props.recentItem.viewingUserId,fqPath:this.props.attachment.fqPath,totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_onPreview:function(e){return e.preventDefault(),this._previewOrOpenFiles(!1)},_renderHeading:function(){var e,n,r;return n=null!=(null!=(r=this.props.attachment.previewInfo)?r.icon:void 0)?this.props.attachment.previewInfo.icon.split("_32")[0]:"page_white_text",e=t.createElement(a,{ref:"recentsItemHeader",header:{heading:i.em_snippet(this.props.attachment.displayName,45),icon:n},attachmentCount:1,handleShare:this._handleShare,handleOpen:this.props.attachment.canOpen?this._handleOpen:null,handleDelete:this._handleDelete,handleMove:this._handleMove,handleRename:this._handleRename,handleReportJunk:this._handleReportJunk,handleDownload:this._handleDownload,handleComment:this._handleComment,handleVersions:this._handleVersions,disableActions:!1,showItemActions:!0})},render:function(){var e;return e=this._renderHeading(),m.li({className:"doc-attachment-item",onClick:_(this._onPreview)},e)}})}),define("modules/dirty/recent_activity/react/recent_activity_container",["jquery","external/underscore","external/react","modules/constants/viewer","modules/clean/page_role_observer","modules/clean/viewer","modules/clean/web_timing_logger","modules/dirty/recent_activity/react/recent_activity_view","modules/dirty/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n,i,a,r,s,o,c,l,h){var u,d,p,m,_;return p=i.ROLE_WORK,d=i.ROLE_PERSONAL,u=h.RECENT_EVENT_FILTER_TYPE,_=function(n){var i,a;return a=0,i=function(){var t;return t=e(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight),t>.8&&t>a&&n(),a=t},window.addEventListener("scroll",t.throttle(i,150,{trailing:!1}),!1)},m=n.createClass({displayName:"RecentActivityContainer",propTypes:function(){return{initialRole:n.PropTypes.oneOf(p,d).isRequired,seenOnboarding:n.PropTypes["boolean"].isRequired}},getInitialState:function(){return{items:[],role:this.props.initialRole,filter:u.ALL,isPending:!1,seenOnboarding:this.props.seenOnboarding}},componentWillMount:function(){var e;return l.addListener(this._onUpdateFromStore),c.loadPage(this._viewingUserId(this.state.role)),e=this._itemsFromStore(this.state.role,this.state.filter),this.setState({isPending:0===e.length,items:e}),a.addListener(this._onRoleUpdate),_(t.throttle(this._onShouldLoadMore,2e3,{trailing:!1})),this._logTimeToInteractive=t.once(s.mark_time_to_interactive.bind(s))},componentDidUpdate:function(){return this.state.items.length?this._logTimeToInteractive():void 0},componentWillUnmount:function(){return l.removeListener(this._onUpdateFromStore),a.removeListener(this._onRoleUpdate)},_onShouldLoadMore:function(){var e;return!this.state.isPending&&(e=c.loadNextPage(this._viewingUserId(this.state.role)))?this.setState({isPending:!0}):void 0},_onUpdateFromStore:function(){var e,t;return t=this._itemsFromStore(this.state.role,this.state.filter),e=!l.isLoadedForUser(this._viewingUserId(this.state.role)),this.setState({isPending:e,items:t})},_onNavChange:function(e){var t;return t=this._itemsFromStore(this.state.role,e),this.setState({filter:e,items:t})},_onOnboardingConfirm:function(){return this.setState({seenOnboarding:!0}),c.markOnboardingAsSeen(this._viewingUserId(this.state.role))},_onRoleUpdate:function(e){var t,n;if(e!==this.state.role)return n=this._viewingUserId(e),t=this._itemsFromStore(e,this.state.filter),c.loadPage(n),this.setState({role:e,items:t,filter:u.ALL,isPending:0===t.length})},_itemsFromStore:function(e,t){return l.filterItemsForUser(this._viewingUserId(e),t)},_viewingUserId:function(e){var t;return t=r.get_viewer(),t.get_user_by_role(e).id},render:function(){return n.createElement(o,{items:this.state.items,filter:this.state.filter,isPending:this.state.isPending,seenOnboarding:this.state.seenOnboarding,onNavChange:this._onNavChange,onOnboardingConfirm:this._onOnboardingConfirm})}})}),define("modules/dirty/recent_activity/react/recent_activity_item_container",["external/underscore","external/react","modules/core/exception","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_view_models","modules/dirty/recent_activity/actions/recent_activity_actions","modules/dirty/recent_activity/react/recent_activity_item_view","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/selection_store"],function(e,t,n,i,a,r,s,o,c){var l,h,u,d,p;return u=n.assert,p=t.DOM,d=t.addons.classSet,l=a.PropTypes,h=t.createClass({displayName:"RecentActivityItemContainer",propTypes:{recentItem:l.recentItem.isRequired},getInitialState:function(){return{attachments:[],selectedAttachmentIds:[]}},componentWillMount:function(){return c.addListener(this._onSelectionStoreChange),o.addListener(this._onAttachmentStoreChange),this.setState({attachments:this._attachmentsFromStore(),selectedAttachmentIds:c.getByRecentItemId(this.props.recentItem.id)})},componentWillUnmount:function(){return c.removeListener(this._onSelectionStoreChange),o.removeListener(this._onAttachmentStoreChange)},_onSelectionStoreChange:function(){return this.setState({selectedAttachmentIds:c.getByRecentItemId(this.props.recentItem.id)})},_onAttachmentStoreChange:function(){return this.setState({attachments:this._attachmentsFromStore()})},_attachmentsFromStore:function(){return o.getByIds(this.props.recentItem.attachmentIds)},_performAction:function(t){var n;if(n=this.state.attachments,this.state.selectedAttachmentIds.length)n=this.state.selectedAttachmentIds.map(function(t){return function(n){return e.findWhere(t.state.attachments,{id:n})}}(this));else if(n.length>1)throw new Error("Cannot perform an action on an aggregation without a selection");return t.call(this,n)},_clearSelection:function(){return r.deselectAttachments(this.props.recentItem.id,this.state.selectedAttachmentIds)},_handleShare:function(){var t,n;return n=this.props.recentItem.viewingUserId,t=this.props.recentItem.attachmentsCount,this._performAction(function(i){var a;return 1===t||1===i.length?(a=i[0],r.shareFile(n,a.fqPath,{viewingUserId:n,fqPath:a.fqPath,totalCount:this.props.recentItem.attachmentsCount,cellView:this})):r.shareCollection(n,i,{viewingUserId:n,fqPaths:e.pluck(i,"fqPath"),totalCount:this.props.recentItem.attachmentsCount,cellView:this})})},_handleOpen:function(){return this._performAction(function(e){var t,n;return u(1===e.length,"_handleOpen only supports a single attachment"),t=e[0],n=this.props.recentItem.viewingUserId,r.openFile(t.nsId,t.nsPath,n,{viewingUserId:n,fqPath:t.fqPath,totalCount:this.props.recentItem.attachmentsCount,
cellView:this})})},_handlePathClick:function(){var t,n;return t=e.pluck(this.state.attachments,"fqPath"),n=this.props.recentItem.attachmentsCount,i.logOpenPathUrl(this.props.recentItem.viewingUserId,t,n,this)},_handleDelete:function(){return this._performAction(function(t){return r.promptAndDeleteAttachments(t,this.props.recentItem.viewingUserId,{viewingUserId:this.props.recentItem.viewingUserId,fqPaths:e.pluck(t,"fqPath"),totalCount:this.props.recentItem.attachmentsCount,cellView:this}),this._clearSelection()})},_handleRename:function(e){var t,n,i;return t=this.state.attachments[0],i=t.viewingUserId,n=t.fqPath,r.renameAttachment(i,n,e,{viewingUserId:i,fqPath:n,totalCount:this.props.recentItem.attachmentsCount,cellView:this})},_handleSelectAll:function(){var t;return t=e.pluck(this.state.attachments,"id"),r.selectAttachments(this.props.recentItem.id,t)},_handleDeselectAll:function(){return r.deselectAttachments(this.props.recentItem.id,this.state.selectedAttachmentIds)},_handleReportJunk:function(){return this._performAction(function(t){var n;return n=e.pluck(t,"fqPath"),r.notifyAndLogReportJunk(this.props.recentItem.viewingUserId,n,this)})},_handlePreview:function(){return this._previewOrOpenFiles({shouldFocusCommentInput:!1})},_handleMove:function(){return this._performAction(function(t){return r.promptAndMoveAttachments(this.props.recentItem,t,{viewingUserId:this.props.recentItem.viewingUserId,fqPaths:e.pluck(t,"fqPath"),totalCount:this.props.recentItem.attachmentsCount,cellView:this}),this._clearSelection()})},_handleToggleSelect:function(e,t){return t?r.selectAttachments(this.props.recentItem.id,[e.id]):r.deselectAttachments(this.props.recentItem.id,[e.id])},_handleDownload:function(){return this._performAction(function(t){var n,i;return i=this.props.recentItem.viewingUserId,n=this.props.recentItem.attachmentsCount,r.downloadFiles(i,t,{viewingUserId:i,fqPaths:e.pluck(t,"fqPath"),totalCount:n,cellView:this})})},_handleComment:function(){return this._performAction(function(e){var t;return u(1===e.length,"_handleComment only supports a single attachment"),t=Math.max(0,this.state.attachments.indexOf(e[0])),this._previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})})},_handleVersions:function(){return this._performAction(function(e){var t,n,i;return u(1===e.length,"_handleVersions only supports a single attachment"),n=e[0].fqPath,i=this.props.recentItem.viewingUserId,t=this.props.recentItem.attachmentsCount,r.openVersions(i,n,{viewingUserId:i,fqPath:n,totalCount:t,cellView:this})})},_previewOrOpenFiles:function(t){var n,i,a,s,o;return null==t&&(t={}),s=t.shouldFocusCommentInput===!0,o=this.props.recentItem.viewingUserId,a=e.pluck(this.state.attachments,"previewInfo"),a=e.compact(a),n=this.state.attachments[0],i=e.isObject(n.previewInfo)&&!e.isEmpty(n.previewInfo),1!==this.props.recentItem.attachmentsCount||i?r.previewFiles(o,a,{index:t.index||0,shouldFocusCommentInput:s},{viewingUserId:o,fqPaths:e.pluck(a,"fq_path"),totalCount:this.props.recentItem.attachmentsCount,cellView:this}):r.browseFile(n.browseUrl)},render:function(){return t.createElement(s,{recentItem:this.props.recentItem,attachments:this.state.attachments,handleShare:this._handleShare,handleOpen:this._handleOpen,handlePreview:this._handlePreview,handleDelete:this._handleDelete,handleRename:this._handleRename,handleMove:this._handleMove,handlePathClick:this._handlePathClick,handleDeselectAll:this._handleDeselectAll,handleReportJunk:this._handleReportJunk,handleSelectAll:this._handleSelectAll,handleToggleSelect:this._handleToggleSelect,handleDownload:this._handleDownload,handleComment:this._handleComment,handleVersions:this._handleVersions,selectedAttachmentIds:this.state.selectedAttachmentIds})}})});var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/recent_activity/react/recent_activity_item_view",["external/underscore","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_view_models","modules/clean/recent_activity/recent_activity_view_helper","modules/dirty/recent_activity/react/attachment_list_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_subheader_view","modules/dirty/recent_activity/react/doc_attachment_list_view"],function(e,t,n,i,a,r,s,o,c,l,h,u){var d,p,m,_,f,g,v,y,w;return g=n._,_=a.RECENT_EVENT_FILTER_TYPE,w=s.ensureUserIntentToClick,d=u.DocAttachmentListView,y=t.DOM,v=t.addons.classSet,m=t.PropTypes,p=r.PropTypes,f=t.createClass({displayName:"RecentActivityItemView",propTypes:{recentItem:p.recentItem.isRequired,attachments:m.arrayOf(p.attachment),handleShare:m.func,handleOpen:m.func,handlePreview:m.func,handleDelete:m.func,handleRename:m.func,handlePathClick:m.func,handleDeselectAll:m.func,handleSelectAll:m.func,handleToggleSelect:m.func,handleMove:m.func,handleReportJunk:m.func,handleDownload:t.PropTypes.func,handleVersions:t.PropTypes.func,handleComment:t.PropTypes.func,selectedAttachmentIds:m.array},getDefaultProps:function(){return{handleShare:function(){},handleOpen:function(){},handlePreview:function(){},handleDelete:function(){},handleRename:function(){},handlePathClick:function(){},handleDeselectAll:function(){},handleSelectAll:function(){},handleToggleSelect:function(){},handleMove:function(){},handleReportJunk:function(){},handleDownload:function(){},handleVersions:function(){},handleComment:function(){},attachments:[],selectedAttachmentIds:[]}},shouldComponentUpdate:function(t){return!e.isEqual(this.props,t)},_heading:function(){var t,n,a,r,s;if(this.props.recentItem.attachmentsCount<2)a=this.props.recentItem.displayName;else{if(t=g("%(count)s files"),n=e.uniq(e.values(this.props.recentItem.filterTypesByKey)),1===n.length)switch(n[0]){case _.DOCUMENTS:t=g("%(count)s documents");break;case _.PHOTOS:t=g("%(count)s images");break;case _.VIDEOS:t=g("%(count)s videos");break;case _.VISUAL_NOTES:t=g("%(count)s visual notes")}else 2===n.length&&(r=_.PHOTOS,indexOf.call(n,r)>=0&&(s=_.VIDEOS,indexOf.call(n,s)>=0)&&(t=g("%(count)s images and videos")));a=t.format({count:this.props.recentItem.attachmentsCount})}return i.em_snippet(a)},_subheading:function(){return t.createElement(h,{type:this.props.recentItem.type,date:new Date(this.props.recentItem.when),handlePathClick:this.props.handlePathClick,paths:this.props.recentItem.paths,viewingUserId:this.props.recentItem.viewingUserId})},_attachmentsWithThumbnails:function(){return e.filter(this.props.attachments,function(e){return!!e.thumbnailUrl})},_isAggregation:function(){return this.props.recentItem.attachmentsCount>1},_shouldShowThumbnailActivity:function(){var t,n,i;return i=e.values(this.props.recentItem.filterTypesByKey),n=function(e){return e===_.PHOTOS||e===_.VIDEOS||e===_.VISUAL_NOTES},t=this.props.attachments,e.every(i,n)||1===t.length&&t[0].thumbnailUrl},_isDoneLoading:function(){return this.props.attachments.length===this.props.recentItem.attachmentsCount},_selectedItemsInRootCollection:function(){return e.all(this.props.selectedAttachmentIds,function(t){return function(n){var i;return i=e.findWhere(t.props.attachments,{id:n}),i.inRootCollection}}(this))},_actionPermissions:function(){var e,t,n,i,a,r;return a=this.props.selectedAttachmentIds.length,r=this._selectedItemsInRootCollection(),e=this._isAggregation(),t=this._isDoneLoading(),n=a>0,i=!e||1===a,{share:i||n&&r,open:t&&i&&this.props.attachments[0].canOpen,"delete":t&&(n||!e),rename:t&&!e,move:t&&(n||!e),download:t&&(n||!e),comment:t&&i,versions:t&&i}},render:function(){var e,n,i,a,r,s,h,u;return e=null,h=!0,this._shouldShowThumbnailActivity()?this._isDoneLoading()?(u=this._attachmentsWithThumbnails(),e=t.createElement(o,{ref:"attachments",attachments:u,duplicateIds:this.props.recentItem.duplicateIds,handleToggleSelect:this.props.handleToggleSelect,selectedAttachmentIds:this.props.selectedAttachmentIds})):e=t.createElement(c,{count:this.props.recentItem.attachmentsCount}):this._isAggregation()&&(h=!1,e=t.createElement(d,{recentItem:this.props.recentItem,attachments:this.props.attachments})),r=this._actionPermissions(),n=function(e,t){return r[e]?t:null},a=t.createElement(l,{ref:"recentsItemHeaderView",header:{heading:this._heading(),subheading:this._subheading(),icon:this.props.recentItem.icon},disableActions:!this._isDoneLoading(),handleShare:n("share",this.props.handleShare),handleOpen:n("open",this.props.handleOpen),handleRename:n("rename",this.props.handleRename),handleDelete:n("delete",this.props.handleDelete),handleMove:n("move",this.props.handleMove),handleDownload:n("download",this.props.handleDownload),handleVersions:n("versions",this.props.handleVersions),handleComment:n("comment",this.props.handleComment),handleDeselectAll:this.props.handleDeselectAll,handleSelectAll:this.props.handleSelectAll,handleReportJunk:this.props.handleReportJunk,selectCount:this.props.selectedAttachmentIds.length,attachmentCount:this.props.recentItem.attachmentsCount,showItemActions:h}),s={"recents-item":!0,"recents-item--show-hover-actions":h,"recents-item--loaded":this._isDoneLoading()},i=h?w(this.props.handlePreview):null,y.li({"data-item-id":this.props.recentItem.id,"data-item-type":this.props.recentItem.type,className:v(s),onClick:this._isDoneLoading()?i:void 0},a,e)}})}),define("modules/dirty/recent_activity/react/recent_activity_list_view",["external/underscore","external/react","modules/core/i18n","modules/dirty/recent_activity/actions/recent_activity_actions","modules/dirty/recent_activity/react/recent_activity_item_container"],function(e,t,n,i,a){var r,s,o,c;return s=n._,c=t.DOM,o=t.addons.classSet,r=t.createClass({displayName:"RecentActivityListView",propTypes:function(){return{items:t.PropTypes.array.isRequired,isPending:t.PropTypes.bool}},getDefaultProps:function(){return{isPending:!1}},render:function(){var e,n,i;return e=function(){var e,n,r,s;for(r=this.props.items,s=[],e=0,n=r.length;n>e;e++)i=r[e],s.push(t.createElement(a,{key:i.id,recentItem:i}));return s}.call(this),n={"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===e.length},c.ul({className:o(n)},e)}})});var slice=[].slice;define("modules/dirty/recent_activity/react/recent_activity_view",["external/underscore","external/react","modules/clean/components/loading_indicator","modules/clean/gandalf_util","modules/clean/recent_activity/react/recent_activity_onboarding_view","modules/clean/recent_activity/react/recent_activity_filter_view","modules/clean/recent_activity/react/recent_activity_blank_slate_view","modules/clean/recent_activity/recent_activity_constants","modules/dirty/recent_activity/react/recent_activity_list_view"],function(e,t,n,i,a,r,s,o,c){var l,h,u,d;return h=o.RECENT_EVENT_FILTER_TYPE,d=t.DOM,l=t.PropTypes,u=t.createClass({displayName:"RecentActivityView",propTypes:function(){return{items:l.array.isRequired,filter:l.oneOf(e.values(h)),isPending:l["boolean"],seenOnboarding:l["boolean"],onNavChange:l.func,onOnboardingConfirm:l.func}},getDefaultProps:function(){return{filter:h.ALL,isPending:!1,seenOnboarding:!1,onNavChange:function(){},onOnboardingConfirm:function(){}}},_onNavChange:function(e){return this.props.onNavChange(e)},_onOnboardingConfirm:function(){return this.props.onOnboardingConfirm()},_renderFilterView:function(){var e,n;return n=1<=arguments.length?slice.call(arguments,0):[],e=i.getGandalfRule("recents-web-photos-visual-notes"),e?t.createElement.apply(t,[r,{filter:this.props.filter,onChange:this._onNavChange}].concat(slice.call(n))):d.div.apply(d,[null].concat(slice.call(n)))},_renderLoadingView:function(){var e;return e=t.createElement(n,{style:n.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}),d.div({className:"recents-loading-view"},e)},_renderOnboardingView:function(){var e,n,i;return e=0===this.props.items.length,n=this.props.filter===h.ALL,i=n&&e&&!this.props.isPending,this.props.seenOnboarding||i?null:t.createElement(a,{onConfirm:this._onOnboardingConfirm})},_renderListView:function(){return t.createElement(c,this.props)},_renderPendingContent:function(){return[this._renderOnboardingView(),this._renderLoadingView(),this._renderListView()]},_renderBlankSlateContent:function(){var e;return e=t.createElement(s,{ref:"blankslate",filter:this.props.filter}),[this._renderOnboardingView(),this._renderFilterView(e)]},_renderLoadedContent:function(){var e;return this.props.isPending&&(e=this._renderLoadingView()),[this._renderOnboardingView(),this._renderFilterView(this._renderListView(),e)]},render:function(){var e;return e=this.props.items.length?this._renderLoadedContent():this.props.isPending?this._renderPendingContent():this._renderBlankSlateContent(),d.div.apply(d,[{className:"recents-view"}].concat(slice.call(e)))}})});